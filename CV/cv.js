/**
 * Created by WangSheng on 2014/9/9.
 */
function RandomPicker(){this.seriesColors=["blue","green","red","lightBlue","darkGreen","yellow","purple"];this.currentSeriesColorIndex=0;this.nodeShape=["circle","rectangular","triangle","reverse-triangle"];this.currentNodeShapeIndex=0}function BasicPieDataAnalyst(e){this.input=e}function X_LinearAxis(e,t,n,r,i,s,o){this.leftPadding=s;this.rightPadding=o;this.svg=e;this.originPosition=i;this.length=t-s-o;this.min=n;this.max=r;this.preferredMarkPixelInterval=100;this.markDataInterval=0;this.markPixelInterval=0;this.markPositions=[];this.labelPositions=[];this.originPosition=i}function Y_LinearAxis(e,t,n,r,i,s,o,u){this.svg=e;this.originPosition;this.length=t;this.min=n;this.max=r;this.preferredMarkPixelInterval=75;this.markDataInterval=0;this.markPixelInterval=0;this.originPosition=i;this.x_axis=s;this.doNotExpandMin=o;this.doNotExpandMax=u;this.markPositions=[];this.labelPositions=[]}function LayoutNoAxes(e,t,n,r){this.svg=e;this.mainTitle=t;this.subTitle=n;this.yAxisTitle=undefined;this.xAxisTitle=undefined;this.xAxisHeight=0;this.yAxisWidth=0;this.legend=r}function GeneralLayout(e,t,n,r,i,s){this.svg=e;this.mainTitle=t;this.subTitle=n;this.yAxisTitle=r;this.xAxisTitle=i;this.legend=s}function Axis(){this.preferredMarkDataIntervals=[1,2,2.5,5,10]}function X_Axis(){}function Y_Axis(){}function BasicLineRegularDataAnalyst(e,t){this.input=e;this.xAxisDataAreaLength=t}function Legend(e,t,n,r,i){this.svg=e;this.height=0;this.width=0;this.rowHeight=25;this.fontSize=15;this.multipleSeries=t;this.positionRelativeToLayout=n;this.shape=r;this.color=i;this.legendSVG_Group=draw.createGroup()}function MultipleLegendLayout(e,t,n,r){this.svg=e;this.mainTitle=t;this.subTitle=n;this.yAxisTitle=undefined;this.xAxisTitle=undefined;this.xAxisHeight=0;this.yAxisWidth=0;this.legendList=r}function Layout(){this.smallMargin=10;this.mediumMargin=20;this.bigMargin=50;this.mainTitleHeight=30;this.mainTitleFontSize=25;this.subTitleHeight=20;this.subTitleFontSize=15;this.yAxisTitleWidth=this.xAxisTitleHeight=20;this.yAxisTitleFontSize=this.xAxisTitleFontSize=15;this.xAxisHeight=20;this.yAxisWidth=30;this.areas=null}function TipControl(e,t,n){this.tip=null;this.hideTipTimeout=0;this.isShown=false;this.isSingleLine=n;this.htmlContainer=e;this.topShift=t;this.sharedSeriesInfo=new SharedSeriesInfo}function SharedSeriesInfo(){this.multipleSeries=[]}function SharedTipControl(e,t){this.htmlContainer=e;this.topShift=t;this.isSingleLine=false;this.sharedSeriesInfo=new SharedSeriesInfo}function PieSliceTriggerControl(){}function StaticTipControl(e,t,n){this.htmlContainer=e;this.topShift=t;this.isSingleLine=n}function TriggerControl(e,t,n){this.tipControl=e;this.seriesName=t;this.mcColor=n;this.sharedSeriesInfo=this.tipControl.sharedSeriesInfo}function SingleLineSeriesViewer(e,t,n,r,i,s,o,u,a,f,l,c){this.htmlContainer=e;this.svg=t;this.svgTrigger=n;this.nodes=r;this.nodeShape=i;this.mcColor=s;this.constantInterval=u;this.isContinual=o;this.seriesName=a;this.xDrawInfo=l;this.yDrawInfo=c;this.svgLayerGroup=draw.createGroup();this.svgTriggerGroup=draw.createGroup();this.tipControl=f}function BasicPieDataViewer(e,t,n,r,i,s,o,u,a,f,l){this.htmlContainer=e;this.svg=t;this.svgTrigger=n;this.input=r;this.center=i;this.dataDrawAreaX=s;this.dataDrawAreaY=o;this.radiusForLabel=u;this.radiusForPie=a;this.radiusForConnectionLineTurn=f;this.total=l}function SinglePieSeriesViewer(e,t,n,r,i,s,o,u,a,f,l,c,h,p){this.svg=e;this.htmlContainer=t;this.tipControl=n;this.svgTrigger=r;this.startAngle=i;this.endAngle=s;this.radiusForLabel=o;this.radiusForPie=u;this.radiusForConnectionLineTurn=a;this.center=f;this.seriesName=l;this.mcColor=c;this.dataY=h;this.slotsController=p}function PieDataLabelSlotsController(){this.leftSlots=[];this.rightSlots=[]}function BasicLineRegularDataViewer(e,t,n,r,i,s,o){this.htmlContainer=e;this.svg=t;this.svgTrigger=n;this.input=r;this.xDrawInfo=i;this.yDrawInfo=s;this.isContinual=o}function convertToCuboidModels(e,t,n,r,i){var s=[];var o=4;var u=8;var a=e.data;var f=e.meta;var l=threeModels.CuboidModel;var c=a.length;var h=a[0].length;var p=getMinMax(a);var d=p.biggestInData;var v=p.smallestInData;var m=d-v;var g=new RandomPicker;for(var y=0;y<c;y++){var b=g.pickSeriesColor();for(var w=0;w<h;w++){var E=o*y-(c-1)*o/2;var S=u*w-(h-1)*u/2;var x=(a[y][w]-v)/m*8;if(x<.05){x=.05}var T=x;var N=[E,T,S];var C=[1,x,1];var k=new l(N,C,b,a[y][w],f.rows[y],f.columns[w],t,n,r);s.push(k)}}if(i){for(var L=0;L<i.length;L++){y=i[L][0];w=i[L][1];s[y*h+w].setFocus()}}return s}function createLabelPlanes(e,t,n){var r=[];var i=e.meta.columns;var s=e.meta.rows.length;var o=4;var u=8;var a=canvasLabelGenerator.create(n);var f=threeModels.PlaneModel;for(var l=0;l<i.length;l++){var c=i[l];var h=a.generateLabelImageDataBasedOnText(c);var p=h.textWidth*(2/h.textHeight);var d=[p/2,1,1];var v=((s-1)*o+2)/2+p/2;var m=u*l-(i.length-1)*u/2;var g=[v,0,m];var y=new f(g,d,false);y.connectWithTexture(h.imageData,t);r.push(y)}return r}function getMinMax(e){var t=e[0][0];var n=e[0][0];for(var r in e){var i=e[r];var s=Math.max.apply(Math,i);var o=Math.min.apply(Math,i);if(s>t){t=s}if(o<n){n=o}}if(n>0){n=0}return{biggestInData:t,smallestInData:n}}var draw={xml_namespace:"http://www.w3.org/2000/svg",createPath:function(e){var t=document.createElementNS(this.xml_namespace,"path");t.setAttributeNS(null,"d",e);return t},createStraightLines:function(e,t,n){var r="M"+e[n]+" "+e[n+1];for(var i=t;i<e.length;i=i+t){r=r+" "+e[i]+" "+e[i+1]}return this.createPath(r)},createStackWithStraightLines:function(e,t,n,r,i){var s="M"+e[n]+" "+e[n+1];for(var o=t;o<e.length;o=o+t){s=s+" "+e[o]+" "+e[o+1]}s=s+" "+r[0]+" "+r[1]+" "+i[0]+" "+i[1]+" "+"Z";return this.createPath(s)},createStraightLine:function(e,t,n,r){var i=document.createElementNS(this.xml_namespace,"line");i.setAttributeNS(null,"x1",e);i.setAttributeNS(null,"y1",t);i.setAttributeNS(null,"x2",n);i.setAttributeNS(null,"y2",r);i.setAttributeNS(null,"stroke","black");return i},createQuadraticBezierCurve:function(e){var t="M"+e[0]+" "+e[1]+" Q "+e[2]+" "+e[3]+" "+e[4]+" "+e[5];return this.createPath(t)},createText:function(e,t,n,r,i,s){var o=document.createElementNS(this.xml_namespace,"text");o.setAttributeNS(null,"x",e);o.setAttributeNS(null,"y",t);if(r){o.setAttributeNS(null,"font-size",r)}else{o.setAttributeNS(null,"font-size","11")}if(i){o.setAttributeNS(null,"text-anchor",i)}if(s==="middle"){o.setAttributeNS(null,"dy","0.3em")}else if(s==="top"){o.setAttributeNS(null,"dy","1em")}if(n!==false){o.textContent=n}return o},createTextSpan:function(e,t,n,r,i,s){var o=document.createElementNS(this.xml_namespace,"tspan");if(e!==false){o.setAttributeNS(null,"x",e)}if(t!==false){o.setAttributeNS(null,"y",t)}if(r){o.setAttributeNS(null,"font-size",r)}else{o.setAttributeNS(null,"font-size","11")}if(i){o.setAttributeNS(null,"text-anchor",i)}if(s){o.setAttributeNS(null,"dominant-baseline",s)}return o},createRectangular:function(e,t,n,r){var i=document.createElementNS(this.xml_namespace,"rect");i.setAttributeNS(null,"x",e);i.setAttributeNS(null,"y",t);i.setAttributeNS(null,"width",n);i.setAttributeNS(null,"height",r);return i},createCircle:function(e,t,n){var r=document.createElementNS(this.xml_namespace,"circle");r.setAttributeNS(null,"cx",e);r.setAttributeNS(null,"cy",t);r.setAttributeNS(null,"r",n);return r},createArcOfCircle:function(e,t,n,r,i){var s=util.polarToCartesian(e,t,n,i);var o=util.polarToCartesian(e,t,n,r);var u=i-r<=180?"0":"1";var a=["M",e,t,"",s[0],s[1],"A",n,n,0,u,0,o[0],o[1],"Z"].join(" ");return this.createPath(a)},createGroup:function(){var e=document.createElementNS(this.xml_namespace,"g");return e},createDefs:function(){var e=document.createElementNS(this.xml_namespace,"defs");return e},rotate:function(e,t,n,r){var i=e.getAttributeNS(null,"transform");if(i){var s=i.split(") ");for(var o=0;o<s.length;o++){if(s[o].substr(0,6)==="rotate"){s[o]="rotate("+r+" "+t+" "+n+")"}}i=s.join(" ")}else{i="rotate("+r+" "+t+" "+n+")"}e.setAttributeNS(null,"transform",i)},translate:function(e,t,n){var r="translate("+t+"px, "+n+"px)";e.style.MozTransform=r;e.style.webkitTransform=r;e.style.msTransform=r;e.style.transform=r},scale:function(e,t){var n=e.getAttributeNS(null,"transform");if(n){var r=n.split(") ");for(var i=0;i<r.length;i++){if(r[i].substr(0,5)==="scale"){r[i]="scale("+t+")"}}n=r.join(" ")}else{n="scale("+t+")"}e.setAttributeNS(null,"transform",n)},setStrokeFill:function(e,t,n,r){if(t){e.setAttributeNS(null,"stroke",t)}if(n!==false){e.setAttributeNS(null,"stroke-width",n)}if(r){e.setAttributeNS(null,"fill",r)}},createLinearGradient:function(e,t){var n=document.createElementNS(this.xml_namespace,"linearGradient");n.setAttributeNS(null,"x1",e[0]);n.setAttributeNS(null,"y1",e[1]);n.setAttributeNS(null,"x2",t[0]);n.setAttributeNS(null,"y2",t[1]);return n},addLinearGradientStop:function(e,t,n,r){var i=document.createElementNS(this.xml_namespace,"stop");i.setAttributeNS(null,"offset",t);i.setAttributeNS(null,"stop-color",n);if(r){i.setAttributeNS(null,"stop-opacity",r)}e.appendChild(i)},setVisibility:function(e,t){if(t){e.setAttributeNS(null,"visibility","visibile")}else{e.setAttributeNS(null,"visibility","hidden")}},setPointerEvent:function(e,t,n){if(t){e.setAttributeNS(null,"pointer-events","fill")}if(n){e.setAttributeNS(null,"pointer-events","stroke")}},setId:function(e,t){e.setAttribute("id",t)}};RandomPicker.prototype.pickSeriesColor=function(){var e=this.seriesColors[this.currentSeriesColorIndex];if(this.currentSeriesColorIndex===this.seriesColors.length-1){this.currentSeriesColorIndex=0}else{this.currentSeriesColorIndex++}return colors[e]};RandomPicker.prototype.pickNodeShape=function(){var e=this.nodeShape[this.currentNodeShapeIndex];if(this.currentNodeShapeIndex===this.nodeShape.length-1){this.currentNodeShapeIndex=0}else{this.currentNodeShapeIndex++}return e};var colors={blue:{strokeColor:"rgb(0, 122, 204)",fillColor:"rgb(0, 153, 255)",linearGradientId:"linear-gradient-blue",linearGradientFill:"url(#linear-gradient-blue)"},purple:{strokeColor:"rgb(82, 0, 163)",fillColor:"rgb(102, 0, 204)",linearGradientId:"linear-gradient-purple",linearGradientFill:"url(#linear-gradient-purple)"},lightBlue:{strokeColor:"rgb(52, 147, 184)",fillColor:"rgb(62, 195, 246)",linearGradientId:"linear-gradient-lightBlue",linearGradientFill:"url(#linear-gradient-lightBlue)"},green:{strokeColor:"rgb(0, 163, 122)",fillColor:"rgb(0, 204, 153)",linearGradientId:"linear-gradient-green",linearGradientFill:"url(#linear-gradient-green)"},darkGreen:{strokeColor:"rgb(35, 156, 97)",fillColor:"rgb(0, 180, 94)",linearGradientId:"linear-gradient-darkGreen",linearGradientFill:"url(#linear-gradient-darkGreen)"},red:{strokeColor:"rgb(173, 32, 0)",fillColor:"rgb(255, 87, 45)",linearGradientId:"linear-gradient-red",linearGradientFill:"url(#linear-gradient-red)"},yellow:{strokeColor:"rgb(163, 122, 0)",fillColor:"rgb(204, 153, 0)",linearGradientId:"linear-gradient-yellow",linearGradientFill:"url(#linear-gradient-yellow)"},initLinearGradients:function(e){function n(e){var n=draw.createLinearGradient(["0%","0%"],["0%","100%"]);draw.addLinearGradientStop(n,"0",e.fillColor,"1");draw.addLinearGradientStop(n,"1",e.fillColor,"0");draw.setId(n,e.linearGradientId);t.appendChild(n)}var t=draw.createDefs();n(this.blue);n(this.purple);n(this.red);n(this.lightBlue);n(this.green);n(this.darkGreen);n(this.yellow);e.appendChild(t)},convertToWebGLcolorArray:function(e){var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");t[0]=+t[0]/255;t[1]=+t[1]/255;t[2]=+t[2]/255;return t}};var util={pickFirstAvailable:function(){for(var e in arguments){var t=arguments[e];if(t!==undefined&&t!==null){return t}}},chooseBetween:function(e,t,n){if(e){return t}else{return n}},perfectNumber:function(e){return parseFloat(e.toPrecision(12))},findElementIdxUsingBinarySearch:function(e,t){var n=0;var r=e.length-1;var i=0;while(r-n>1){i=Math.floor((r-n)/2);if(t<e[n+i]){r=n+i}else{n=n+i}}var s=t-e[n];var o=e[r]-t;if(s<o){return n}else if(s>o){return r}else{return n}},polarToCartesian:function(e,t,n,r){var i=(r-90)*Math.PI/180;return[e+n*Math.cos(i),t+n*Math.sin(i)]}};var nodeDrawer={draw:function(e,t,n,r){switch(e){case"circle":return this.drawCircleNode(t,n,r,4,1);case"rectangular":return this.drawRectangularNode(t,n,r,8,8,1);case"triangle":return this.drawTriangleNode(t,n,r,5,1);case"reverse-triangle":return this.drawReverseTriangleNode(t,n,r,5,1)}},drawHighlightedNode:function(e,t){switch(e){case"circle":return this.drawCircleNode(t,0,0,6,3);case"rectangular":return this.drawRectangularNode(t,0,0,12,12,3);case"triangle":return this.drawTriangleNode(t,0,0,7,3);case"reverse-triangle":return this.drawReverseTriangleNode(t,0,0,7,3)}},drawCircleNode:function(e,t,n,r,i){var s=draw.createCircle(t,n,r);draw.setStrokeFill(s,e.strokeColor,i,e.fillColor);return s},drawRectangularNode:function(e,t,n,r,i,s){var t=t-r/2;var n=n-i/2;var o="M"+t+" "+n+" "+(t+r)+" "+n+" "+(t+r)+" "+(n+i)+" "+t+" "+(n+i)+"Z";var u=draw.createPath(o);draw.setStrokeFill(u,e.strokeColor,s,e.fillColor);return u},drawTriangleNode:function(e,t,n,r,i){var s=r*Math.sin(Math.PI/6);var o=r*Math.cos(Math.PI/6);var u=(r+s)/2;var a="M"+t+" "+(n-u)+" "+(t-o)+" "+(n+u)+" "+(t+o)+" "+(n+u)+"Z";var f=draw.createPath(a);draw.setStrokeFill(f,e.strokeColor,i,e.fillColor);return f},drawReverseTriangleNode:function(e,t,n,r,i){var s=r*Math.sin(Math.PI/6);var o=r*Math.cos(Math.PI/6);var u=(r+s)/2;var a="M"+(t-o)+" "+(n-u)+" "+(t+o)+" "+(n-u)+" "+t+" "+(n+u)+"Z";var f=draw.createPath(a);draw.setStrokeFill(f,e.strokeColor,i,e.fillColor);return f},drawTrigger:function(e,t,n){var r=draw.createCircle(e,t,10);draw.setStrokeFill(r,false,false,"rgba(0,0,0,0)");r.ws_nodesStrideIdx=n;return r}};BasicPieDataAnalyst.prototype.analyze=function(){var e=0;for(var t=0;t<this.input.series.length;t++){e=e+this.input.series[t][1]}return{total:e}};X_LinearAxis.prototype=new X_Axis;X_LinearAxis.prototype.constructor=X_LinearAxis;Y_LinearAxis.prototype=new Y_Axis;Y_LinearAxis.prototype.constructor=Y_LinearAxis;Y_LinearAxis.prototype.draw=function(){this.drawMarks();this.drawLabels()};LayoutNoAxes.prototype=new Layout;LayoutNoAxes.prototype.constructor=LayoutNoAxes;LayoutNoAxes.prototype.analyze=function(){function o(t){var n=t.leftArea.width+e.yAxisWidth;var r=t.topArea.height+t.leftArea.height;return[n,r]}function u(){var e=19;var t;if(i<r){t=i/2}else{t=r/2}var n=t-e/2;var s=n-30;var o=n-20;return[n,s,o]}var e=this;var t=this.calculateOuterAreasSizes();var n=o(t);var r=t.leftArea.height;var i=t.topArea.width-this.yAxisWidth;var s=u();return{dataDrawAreaX:i,dataDrawAreaY:r,center:[n[0]+i/2,n[1]-r/2],radiusForLabel:s[0],radiusForPie:s[1],radiusForConnectionLine:s[2]}};GeneralLayout.prototype=new Layout;GeneralLayout.prototype.constructor=GeneralLayout;GeneralLayout.prototype.calculateHeightOfFixedTopMargin=function(){if(!this.mainTitle&&!this.subTitle){return this.bigMargin}else if(!this.mainTitle&&this.subTitle){return this.mediumMargin}else{return this.smallMargin}};Axis.prototype.draw=function(){this.drawMarks();this.drawLabels()};Axis.prototype.adjustMarkInterval=function(){var e=(this.max-this.min)/this.length;var t=e*this.preferredMarkPixelInterval;var n=t;var r=Math.pow(10,Math.floor(Math.log(t)/Math.log(10)));t=t/r;for(var i=0;i<this.preferredMarkDataIntervals.length;i++){if(t<(this.preferredMarkDataIntervals[i]+util.pickFirstAvailable(this.preferredMarkDataIntervals[i+1],this.preferredMarkDataIntervals[i]))/2){t=this.preferredMarkDataIntervals[i];break}}t=t*r;this.markDataInterval=t;this.markPixelInterval=t/n*this.preferredMarkPixelInterval};X_Axis.prototype=new Axis;X_Axis.prototype.constructor=X_Axis;X_Axis.prototype.analyze=function(){this.adjustMarkInterval();this.calculateMarkPositions();this.calculateLabelPositions();return this.analyzeReturn()};X_Axis.prototype.analyzeReturn=function(){var e=this.originPosition[0]+this.leftPadding;var t=this.markPixelInterval/this.markDataInterval;var n=this.min;return{startPoint:e,pixelPerData:t,length:this.length,min:n}};X_Axis.prototype.drawMarks=function(){var e="";for(var t=0;t<this.markPositions.length;t=t+2){var n=this.markPositions[t];var r=this.markPositions[t+1];var i=n;var s=r+5;e=e+"M"+n+" "+r+" L"+i+" "+s+" "}e=e.trim();var o=draw.createPath(e);draw.setStrokeFill(o,"darkgray",false,false);this.svg.appendChild(o)};X_Axis.prototype.drawLabels=function(){var e=draw.createGroup();var t=this.min;for(var n=0;n<this.labelPositions.length;n=n+2){t=util.perfectNumber(this.min+this.markDataInterval*n/2);e.appendChild(draw.createText(this.labelPositions[n],this.labelPositions[n+1],t,11,"middle",false))}this.svg.appendChild(e)};X_Axis.prototype.calculateMarkPositions=function(){var e=this.originPosition[0]+this.leftPadding;var t=this.originPosition[1];var n=this.min;while(n<this.max||n===this.max){this.markPositions.push(e);this.markPositions.push(t);e=e+this.markPixelInterval;n=util.perfectNumber(n+this.markDataInterval)}};X_Axis.prototype.calculateLabelPositions=function(){for(var e=0;e<this.markPositions.length;e=e+2){this.labelPositions.push(this.markPositions[e]);this.labelPositions.push(this.markPositions[e+1]+16)}};Y_Axis.prototype=new Axis;Y_Axis.prototype.constructor=Y_Axis;Y_Axis.prototype.analyze=function(){this.adjustMarkInterval();this.calculateMarkPositions();this.calculateLabelPositions();var e=this.originPosition[1];var t=this.markPixelInterval/this.markDataInterval;var n=this.min;return{startPoint:e,pixelPerData:t,min:n}};Y_Axis.prototype.adjustMarkInterval=function(){Axis.prototype.adjustMarkInterval.apply(this);var e=util.perfectNumber(this.markDataInterval*Math.floor(this.min/this.markDataInterval));if(this.min===e&&!this.doNotExpandMin){this.min=util.perfectNumber(this.min-this.markDataInterval)}else{this.min=e}var t=util.perfectNumber(this.markDataInterval*Math.ceil(this.max/this.markDataInterval));if(this.max===t&&!this.doNotExpandMax){this.max=util.perfectNumber(this.max+this.markDataInterval)}else{this.max=t}var n=(this.max-this.min)/this.markDataInterval;this.markPixelInterval=this.length/n};Y_Axis.prototype.calculateMarkPositions=function(){var e=this.originPosition[0];var t=this.originPosition[1];var n=this.min;while(n<this.max||n===this.max){this.markPositions.push(e);this.markPositions.push(t);t=t-this.markPixelInterval;n=util.perfectNumber(n+this.markDataInterval)}};Y_Axis.prototype.calculateLabelPositions=function(){for(var e=0;e<this.markPositions.length;e=e+2){this.labelPositions.push(this.markPositions[e]);this.labelPositions.push(this.markPositions[e+1])}};Y_Axis.prototype.drawMarks=function(){var e="";var t=this.x_axis.length+util.pickFirstAvailable(this.x_axis.leftPadding,0)+util.pickFirstAvailable(this.x_axis.rightPadding,0);for(var n=0;n<this.markPositions.length;n=n+2){var r=this.markPositions[n];var i=this.markPositions[n+1];var s=r+t;var o=i;e=e+"M"+r+" "+i+" L"+s+" "+o+" "}e=e.trim();var u=draw.createPath(e);draw.setStrokeFill(u,"darkgray","1","none");this.svg.appendChild(u)};Y_Axis.prototype.drawLabels=function(){var e=this.min;for(var t=0;t<this.labelPositions.length;t=t+2){e=util.perfectNumber(this.min+this.markDataInterval*t/2);this.svg.appendChild(draw.createText(this.labelPositions[t]-10,this.labelPositions[t+1],e,"11","end","middle"))}};var dataAnalystCommons={isContinual:function(e,t){if(e/t<20){return true}else{return false}}};BasicLineRegularDataAnalyst.prototype.analyze=function(){var e=null;var t=null;var n=null;var r=false;for(var i=0;i<this.input.series.length;i++){var s=this.analyzeSingleSeries(this.input.series[i][1]);if(e===null){e=s.maxX}if(t===null){t=s.minY}else if(t>s.minY){t=s.minY}if(n===null){n=s.maxY}else if(n<s.maxY){n=s.maxY}if(s.isContinual){r=true}}return{minX:this.input.start,maxX:e,minY:t,maxY:n,isContinual:r}};BasicLineRegularDataAnalyst.prototype.analyzeSingleSeries=function(e){var t=e[0];var n=e[0];var r=util.chooseBetween(this.input.start===undefined,0,this.input.start)+(e.length-1)*this.input.interval;var i=e.length;for(var s=0;s<e.length;s++){if(e[s]>n){n=e[s]}if(e[s]<t){t=e[s]}}var o=dataAnalystCommons.isContinual(this.xAxisDataAreaLength,i);return{maxX:r,minY:t,maxY:n,isContinual:o}};Legend.prototype.analyze=function(e,t){if(this.positionRelativeToLayout==="none")return;this.svg.appendChild(this.legendSVG_Group);var n=new RandomPicker;var r;if(!e){r=[];for(var i=0;i<this.multipleSeries.length;i++){r.push(this.multipleSeries[i][0])}}else{r=e}if(this.positionRelativeToLayout==="left"||this.positionRelativeToLayout==="right"){for(var i=0;i<r.length;i++){var s=r[i];var o=draw.createText(20,this.rowHeight*i+this.rowHeight/2,s,this.fontSize,"start","middle");this.legendSVG_Group.appendChild(o);if(t===undefined||t===true){var u=nodeDrawer.draw(util.pickFirstAvailable(this.shape,n.pickNodeShape()),util.pickFirstAvailable(this.color,n.pickSeriesColor()),10,this.rowHeight*i+this.rowHeight/2);this.legendSVG_Group.appendChild(u)}}}if(this.positionRelativeToLayout==="top"||this.positionRelativeToLayout==="bottom"){var a=0;for(var i=0;i<r.length;i++){var s=r[i];var o=draw.createText(10+a,this.rowHeight/2,s,this.fontSize,"start","middle");this.legendSVG_Group.appendChild(o);if(t===undefined||t===true){var u=nodeDrawer.draw(util.pickFirstAvailable(this.shape,n.pickNodeShape()),util.pickFirstAvailable(this.color,n.pickSeriesColor()),0+a,this.rowHeight/2);this.legendSVG_Group.appendChild(u)}a=a+30+o.getBoundingClientRect().width}}draw.setVisibility(this.legendSVG_Group,false);this.width=this.legendSVG_Group.getBoundingClientRect().width;this.height=this.legendSVG_Group.getBoundingClientRect().height};Legend.prototype.draw=function(e,t){e=e-this.width/2;t=t-this.height/2;draw.translate(this.legendSVG_Group,e,t);draw.setVisibility(this.legendSVG_Group,true)};MultipleLegendLayout.prototype=new Layout;MultipleLegendLayout.prototype.constructor=MultipleLegendLayout;MultipleLegendLayout.prototype.calculateHeightOfFixedTopMargin=function(){if(!this.mainTitle&&!this.subTitle){return this.bigMargin}else if(!this.mainTitle&&this.subTitle){return this.mediumMargin}else{return this.smallMargin}};MultipleLegendLayout.prototype.calculateHeightOfTopLegendComponent=function(){for(var e=0;e<this.legendList.length;e++){if(this.legendList[e].positionRelativeToLayout==="top"){return this.legendList[e].height+this.mediumMargin}}return 0};MultipleLegendLayout.prototype.calculateWidthOfLeftLegendComponent=function(){for(var e=0;e<this.legendList.length;e++){if(this.legendList[e].positionRelativeToLayout==="left"){return this.legendList[e].width+this.smallMargin}}return 0};MultipleLegendLayout.prototype.calculateHeightOfBottomLegendComponent=function(){for(var e=0;e<this.legendList.length;e++){if(this.legendList[e].positionRelativeToLayout==="bottom"){return this.legendList[e].height+this.smallMargin}}return 0};MultipleLegendLayout.prototype.calculateWidthOfRightLegendComponent=function(){for(var e=0;e<this.legendList.length;e++){if(this.legendList[e].positionRelativeToLayout==="right"){console.log(this.legendList[e].width+this.smallMargin);return this.legendList[e].width+this.smallMargin}}return 0};MultipleLegendLayout.prototype.analyze=function(){function s(t){var n=t.leftArea.width+e.yAxisWidth;var r=t.topArea.height+t.leftArea.height;return[n,r]}var e=this;var t=this.calculateOuterAreasSizes();var n=s(t);var r=t.leftArea.height;var i=t.topArea.width-this.yAxisWidth;return{originPosition:n,dataDrawAreaX:i,dataDrawAreaY:r}};MultipleLegendLayout.prototype.drawLegend=function(){var e=this.calculateOuterAreasSizes();for(var t=0;t<this.legendList.length;t++){if(this.legendList[t].positionRelativeToLayout==="left"){this.legendList[t].draw(e.leftArea.origin[0]+this.legendList[t].width/2,e.leftArea.origin[1]+e.leftArea.height/2)}if(this.legendList[t].positionRelativeToLayout==="right"){this.legendList[t].draw(e.rightArea.origin[0]+this.legendList[t].width/2,e.rightArea.origin[1]+e.rightArea.height/2)}if(this.legendList[t].positionRelativeToLayout==="top"){var n=e.topArea.origin[0]+e.topArea.width/2;var r=this.calculateHeightOfFixedTopMargin()+this.calculateHeightOfMainTitleComponent()+this.calculateHeightOfSubTitleComponent()+this.legendList[t].height/2;this.legendList[t].draw(n,r)}if(this.legendList[t].positionRelativeToLayout==="bottom"){var n=e.bottomArea.origin[0]+e.bottomArea.width/2;var r=e.bottomArea.origin[1]+this.calculateHeightOfXAxisTitleComponent()+this.smallMargin+this.legendList[t].height/2;this.legendList[t].draw(n,r)}}};Layout.prototype.calculateHeightOfFixedTopMargin=function(){return this.smallMargin};Layout.prototype.calculateHeightOfMainTitleComponent=function(){return util.chooseBetween(this.mainTitle,this.mainTitleHeight+this.smallMargin,0)};Layout.prototype.calculateHeightOfSubTitleComponent=function(){return util.chooseBetween(this.subTitle,this.subTitleHeight+this.smallMargin,0)};Layout.prototype.calculateHeightOfTopLegendComponent=function(){return util.chooseBetween(this.legend.positionRelativeToLayout==="top",this.legend.height+this.mediumMargin,0)};Layout.prototype.calculateWidthOfLeftFixedMargin=function(){return this.smallMargin};Layout.prototype.calculateWidthOfLeftLegendComponent=function(){return util.chooseBetween(this.legend.positionRelativeToLayout==="left",this.legend.width+this.smallMargin,0)};Layout.prototype.calculateWidthOfYAxisTitleComponent=function(){return util.chooseBetween(this.yAxisTitle,this.yAxisTitleWidth+this.smallMargin,0)};Layout.prototype.calculateHeightOfFixedBottomMargin=function(){return this.smallMargin};Layout.prototype.calculateHeightOfBottomLegendComponent=function(){return util.chooseBetween(this.legend.positionRelativeToLayout==="bottom",this.legend.height+this.smallMargin,0)};Layout.prototype.calculateHeightOfXAxisTitleComponent=function(){return util.chooseBetween(this.xAxisTitle,this.xAxisTitleHeight+this.smallMargin,0)};Layout.prototype.calculateWidthOfRightFixedMargin=function(){return this.smallMargin};Layout.prototype.calculateWidthOfRightLegendComponent=function(){return util.chooseBetween(this.legend.positionRelativeToLayout==="right",this.legend.width+this.smallMargin,0)};Layout.prototype.calculateOuterAreasSizes=function(){function c(){return e.calculateHeightOfFixedTopMargin()+e.calculateHeightOfMainTitleComponent()+e.calculateHeightOfSubTitleComponent()+e.calculateHeightOfTopLegendComponent()}function h(){return e.calculateWidthOfLeftFixedMargin()+e.calculateWidthOfLeftLegendComponent()+e.calculateWidthOfYAxisTitleComponent()}function p(){return e.calculateHeightOfFixedBottomMargin()+e.calculateHeightOfBottomLegendComponent()+e.calculateHeightOfXAxisTitleComponent()}function d(){return e.calculateWidthOfRightFixedMargin()+e.calculateWidthOfRightLegendComponent()}if(this.areas!==null){return this.areas}var e=this;var t=c();var n=h();var r=p();var i=d();var s=+this.svg.getAttribute("width");var o=+this.svg.getAttribute("height");var u={origin:[n,0],width:s-n-i,height:t};var a={origin:[0,t],width:n,height:o-t-r-this.xAxisHeight};var f={origin:[s-i,t],width:i,height:a.height};var l={origin:[n,o-r],width:u.width,height:r};this.areas={topArea:u,leftArea:a,rightArea:f,bottomArea:l};return this.areas};Layout.prototype.analyze=function(){function s(t){var n=t.leftArea.width+e.yAxisWidth;var r=t.topArea.height+t.leftArea.height;return[n,r]}var e=this;var t=this.calculateOuterAreasSizes();var n=s(t);var r=t.leftArea.height;var i=t.topArea.width-this.yAxisWidth;return{originPosition:n,xAxisLength:i,yAxisLength:r}};Layout.prototype.drawTitles=function(){var e=this.calculateOuterAreasSizes();var t=e.topArea;var n=e.leftArea;var r=e.rightArea;var i=e.bottomArea;if(this.mainTitle){var s=t.origin[0]+t.width/2;var o=this.calculateHeightOfFixedTopMargin()+this.mainTitleHeight/2;this.svg.appendChild(draw.createText(s,o,this.mainTitle,this.mainTitleFontSize,"middle","middle"))}if(this.subTitle){var s=t.origin[0]+t.width/2;var o=this.calculateHeightOfFixedTopMargin()+this.calculateHeightOfMainTitleComponent()+this.subTitleHeight/2;var u=draw.createText(s,o,this.subTitle,this.subTitleFontSize,"middle","middle");draw.setStrokeFill(u,"none",false,"#6E6F6F");this.svg.appendChild(u)}if(this.yAxisTitle){var s=n.origin[0]+this.calculateWidthOfLeftFixedMargin()+this.calculateWidthOfLeftLegendComponent()+this.yAxisTitleWidth/2;var o=t.height+n.height/2;var a=draw.createText(s,o,this.yAxisTitle,this.yAxisTitleFontSize,"middle","middle");draw.setStrokeFill(a,"none",false,"#6E6F6F");draw.rotate(a,s,o,-90);this.svg.appendChild(a)}if(this.xAxisTitle){var s=i.origin[0]+i.width/2;var o=i.origin[1]+this.smallMargin+this.xAxisTitleHeight/2;var f=draw.createText(s,o,this.xAxisTitle,this.xAxisTitleFontSize,"middle","middle");draw.setStrokeFill(f,"none",false,"#6E6F6F");this.svg.appendChild(f)}};Layout.prototype.drawLegend=function(){var e=this.calculateOuterAreasSizes();if(this.legend.positionRelativeToLayout==="left"){this.legend.draw(e.leftArea.origin[0]+this.legend.width/2,e.leftArea.origin[1]+e.leftArea.height/2)}if(this.legend.positionRelativeToLayout==="right"){this.legend.draw(e.rightArea.origin[0]+this.legend.width/2,e.rightArea.origin[1]+e.rightArea.height/2)}if(this.legend.positionRelativeToLayout==="top"){var t=e.topArea.origin[0]+e.topArea.width/2;var n=this.calculateHeightOfFixedTopMargin()+this.calculateHeightOfMainTitleComponent()+this.calculateHeightOfSubTitleComponent()+this.legend.height/2;this.legend.draw(t,n)}if(this.legend.positionRelativeToLayout==="bottom"){var t=e.bottomArea.origin[0]+e.bottomArea.width/2;var n=e.bottomArea.origin[1]+this.calculateHeightOfXAxisTitleComponent()+this.smallMargin+this.legend.height/2;this.legend.draw(t,n)}};Layout.prototype.draw=function(){this.drawTitles();this.drawLegend()};TipControl.prototype.createTip=function(e,t){var n=document.createElement("div");this.tip=n;if(this.isSingleLine){if(e!==null&&e!==undefined){e(n)}else{var r=document.createElement("span");n.appendChild(r);r.appendChild(document.createTextNode("null"));n.appendChild(document.createTextNode(" -- "));var i=document.createElement("span");n.appendChild(i);i.appendChild(document.createTextNode("null"))}}else{if(t!==null&&t!==undefined){t(n)}else{n.appendChild(document.createTextNode("null"));n.appendChild(document.createElement("br"));n.appendChild(document.createTextNode("null"))}}n.setAttribute("class","mc-tip");this.htmlContainer.appendChild(n);var s=n.getBoundingClientRect();n.style.marginTop=-s.height-2-this.topShift+"px";n.style.borderColor="black";n.style.display="none";n.style.webkitTransitionDuration="0.3s";n.style.MozTransitionDuration="0.3s";n.style.transitionDuration="0.3s"};TipControl.prototype.showTip=function(e,t,n,r){if(this.isSingleLine){this.showSingleLineTip(e,t,n,r)}else{this.showDoubleLineTip(e,t,n,r)}};TipControl.prototype.showSingleLineTip=function(e,t,n,r){var i=this.sharedSeriesInfo.getSeriesName(n);var s=this.sharedSeriesInfo.getSeriesMCcolor(n);var o=this.sharedSeriesInfo.getDataY(n,r);this.genericShowTip(e,t,i,s,0,o)};TipControl.prototype.showDoubleLineTip=function(e,t,n,r){var i=this.sharedSeriesInfo.getSeriesName(n);var s=this.sharedSeriesInfo.getSeriesMCcolor(n);var o=this.sharedSeriesInfo.getDataX(n,r);var u=this.sharedSeriesInfo.getDataY(n,r);this.genericShowDoubleLineTip(e,t,i,s,o,u)};TipControl.prototype.genericShowTip=function(e,t,n,r,i,s){if(this.isSingleLine){this.genericShowSingleLineTip(e,t,n,r,s)}else{this.genericShowDoubleLineTip(e,t,n,r,i,s)}};TipControl.prototype.genericShowSingleLineTip=function(e,t,n,r,i){this.tip.childNodes[0].childNodes[0].nodeValue=n;this.tip.childNodes[2].childNodes[0].nodeValue=i;this.applyTranslationAndColor(e,t,r)};TipControl.prototype.genericShowDoubleLineTip=function(e,t,n,r,i,s){this.tip.childNodes[0].nodeValue=n;this.tip.childNodes[2].nodeValue=i+" -- "+s;this.applyTranslationAndColor(e,t,r)};TipControl.prototype.genericShowDoubleLineTipDataYOnly=function(e,t,n,r,i){this.tip.childNodes[0].nodeValue=n;this.tip.childNodes[2].nodeValue=i;this.applyTranslationAndColor(e,t,r)};TipControl.prototype.applyTranslationAndColor=function(e,t,n){if(this.hideTipTimeout!==0){window.clearTimeout(this.hideTipTimeout)}if(!this.isShown){this.isShown=true;this.tip.style.webkitTransitionProperty="none";this.tip.style.MozTransitionProperty="none";this.tip.style.transitionProperty="none";this.tip.style.display="inline-block"}else{this.tip.style.webkitTransitionProperty="-webkit-transform";this.tip.style.MozTransitionProperty="-moz-transform";this.tip.style.transitionProperty="transform"}var r=this.tip.getBoundingClientRect();var i="translate("+(e-r.width/2)+"px, "+t+"px)";this.tip.style.MozTransform=i;this.tip.style.webkitTransform=i;this.tip.style.msTransform=i;this.tip.style.transform=i;this.tip.style.borderColor=n.strokeColor};TipControl.prototype.hideTip=function(){var e=this;if(this.hideTipTimeout!==0){window.clearTimeout(this.hideTipTimeout)}this.hideTipTimeout=window.setTimeout(function(){e.isShown=false;e.tip.style.display="none";e.hideTipTimeout=0},1e3)};TipControl.prototype.hideTipImmediately=function(){if(this.hideTipTimeout!==0){window.clearTimeout(this.hideTipTimeout)}this.isShown=false;this.tip.style.display="none";this.hideTipTimeout=0};SharedSeriesInfo.prototype.registerSingleSeries=function(e,t,n,r){var i=new Array(4);i[0]=e;i[1]=t;i[2]=n;i[3]=r;this.multipleSeries.push(i);return this.multipleSeries.length-1};SharedSeriesInfo.prototype.getSeriesName=function(e){return this.multipleSeries[e][0]};SharedSeriesInfo.prototype.getSeriesMCcolor=function(e){return this.multipleSeries[e][1]};SharedSeriesInfo.prototype.getHighlightedNode=function(e){return this.multipleSeries[e][2]};SharedSeriesInfo.prototype.getDataX=function(e,t){return this.multipleSeries[e][3][t*4+2]};SharedSeriesInfo.prototype.getDataY=function(e,t){return this.multipleSeries[e][3][t*4+3]};SharedSeriesInfo.prototype.getPixelX=function(e,t){return this.multipleSeries[e][3][t*4]};SharedSeriesInfo.prototype.getPixelY=function(e,t){return this.multipleSeries[e][3][t*4+1]};SharedSeriesInfo.prototype.reverse=function(){this.multipleSeries.reverse()};SharedTipControl.prototype=new TipControl;SharedTipControl.prototype.constructor=SharedTipControl;SharedTipControl.prototype.createTip=function(e){function t(e){}function n(t){var n=document.createTextNode("null");t.appendChild(n);t.ws_dataXslot=n;t.ws_dataYslots=[];for(var r=0;r<e.length;r++){var i=document.createElement("div");t.appendChild(i);var s=document.createElement("span");i.appendChild(s);s.appendChild(document.createTextNode(e[r]));i.appendChild(document.createTextNode(" -- "));var o=document.createElement("span");i.appendChild(o);var u=document.createTextNode("null");o.appendChild(u);t.ws_dataYslots.push(u)}}TipControl.prototype.createTip.call(this,t,n)};SharedTipControl.prototype.showSingleLineTip=function(){};SharedTipControl.prototype.showDoubleLineTip=function(e,t,n,r){var i=this.sharedSeriesInfo.getSeriesMCcolor(n);var s=this.sharedSeriesInfo.getDataX(n,r);this.tip.ws_dataXslot.nodeValue=s;for(var o=0;o<this.tip.ws_dataYslots.length;o++){this.tip.ws_dataYslots[o].nodeValue=this.sharedSeriesInfo.getDataY(o,r)}this.applyTranslationAndColor(e,t,i)};PieSliceTriggerControl.prototype.enablePieSliceTrigger=function(e,t,n,r,i,s){e.addEventListener("mouseover",function(){n.genericShowTip(t[0],t[1],r,i,0,s)});e.addEventListener("mouseout",function(){n.hideTip()})};StaticTipControl.prototype=new TipControl;StaticTipControl.prototype.constructor=StaticTipControl;StaticTipControl.prototype.createTip=function(e,t){var n=document.createElement("div");this.tip=n;if(this.isSingleLine){if(e!==null&&e!==undefined){e(n)}else{var r=document.createElement("span");n.appendChild(r);r.appendChild(document.createTextNode("null"));n.appendChild(document.createTextNode(" -- "));var i=document.createElement("span");n.appendChild(i);i.appendChild(document.createTextNode("null"))}}else{if(t!==null&&t!==undefined){t(n)}else{n.appendChild(document.createTextNode("null"));n.appendChild(document.createElement("br"));n.appendChild(document.createTextNode("null"))}}n.setAttribute("class","mc-tip");this.htmlContainer.appendChild(n);var s=n.getBoundingClientRect();n.style.marginTop=-s.height-2-this.topShift+"px";n.style.borderColor="black";n.style.display="none"};StaticTipControl.prototype.applyTranslationAndColor=function(e,t,n){this.tip.style.display="inline-block";var r=this.tip.getBoundingClientRect();var i="translate("+(e-r.width/2)+"px, "+t+"px)";this.tip.style.MozTransform=i;this.tip.style.webkitTransform=i;this.tip.style.msTransform=i;this.tip.style.transform=i;this.tip.style.borderColor=n.strokeColor};StaticTipControl.prototype.hideTip=function(){this.hideTipImmediately()};StaticTipControl.prototype.hideTipImmediately=function(){this.tip.style.display="none"};TriggerControl.prototype.enableColumnTrigger=function(e,t,n,r,i){var s=this;var o=this.sharedSeriesInfo;var u=o.registerSingleSeries(n,r,null,i);e.addEventListener("mouseover",function(e){var n=s.sharedSeriesInfo.getPixelX(u,0);var r=e.clientY-t.getBoundingClientRect().top;s.tipControl.showTip(n,r,u,0);e.stopPropagation()});e.addEventListener("mouseout",function(e){s.tipControl.hideTip();e.stopPropagation()})};TriggerControl.prototype.enableNodeTrigger=function(e,t,n,r,i){function f(e,t){if(!a){draw.setVisibility(r,true);a=true}draw.translate(r,e,t)}function l(){if(a){draw.setVisibility(r,false);a=false}}var s=this.sharedSeriesInfo;var o=s.registerSingleSeries(t,n,r,i);var u=this;var a=false;e.addEventListener("mouseover",function(e){var t=s.getPixelX(o,e.target.ws_nodesStrideIdx);var n=s.getPixelY(o,e.target.ws_nodesStrideIdx);f(t,n);u.tipControl.showTip(t,n,o,e.target.ws_nodesStrideIdx);e.stopPropagation()});e.addEventListener("mouseout",function(e){l();u.tipControl.hideTip();e.stopPropagation()})};TriggerControl.prototype.enableRoutineTrace=function(e,t,n,r,i,s,o){var u=this.sharedSeriesInfo;var a=u.registerSingleSeries(t,n,null,r);var f=this;var l=-1;var c=0;var h=0;var p;if(s!==false){p=function(){var t=c-e.getBoundingClientRect().left;var n=(t-o.startPoint)/o.pixelPerData+o.min;var r=Math.round((n-o.min)/s);if(r!==l){l=r;var i=f.sharedSeriesInfo.getPixelX(a,r);var u=f.sharedSeriesInfo.getPixelY(a,r);f.tipControl.showTip(i,u,a,r)}}}else{var d=[];for(var v=0;v<r.length;v=v+4){d.push(r[v+2])}p=function(){var t=c-e.getBoundingClientRect().left;var n=(t-o.startPoint)/o.pixelPerData+o.min;var r=util.findElementIdxUsingBinarySearch(d,n);if(r!==l){l=r;var i=f.sharedSeriesInfo.getPixelX(a,r);var s=f.sharedSeriesInfo.getPixelY(a,r);f.tipControl.showTip(i,s,a,r)}}}i.addEventListener("mousemove",function(e){c=e.clientX});i.addEventListener("mouseover",function(e){l=-1;c=e.clientX;p();h=window.setInterval(p,200)});i.addEventListener("mouseout",function(){window.clearInterval(h);f.tipControl.hideTip()})};SingleLineSeriesViewer.prototype.draw=function(){this.svgLayerGroup.appendChild(this.drawLine());this.drawNodes();var e=this.drawHighlightNode();this.enableNodeTrigger(e);this.enableRoutineTrace();this.svg.appendChild(this.svgLayerGroup);this.svgTrigger.appendChild(this.svgTriggerGroup)};SingleLineSeriesViewer.prototype.drawLine=function(){var e=draw.createStraightLines(this.nodes,4,0);draw.setStrokeFill(e,this.mcColor.strokeColor,2,"none");return e};SingleLineSeriesViewer.prototype.drawNodes=function(){if(this.isContinual){return}var e=draw.createGroup();for(var t=0;t<this.nodes.length;t=t+4){var n=nodeDrawer.draw(this.nodeShape,this.mcColor,this.nodes[t],this.nodes[t+1]);e.appendChild(n)}this.svgLayerGroup.appendChild(e)};SingleLineSeriesViewer.prototype.drawHighlightNode=function(){var e=nodeDrawer.drawHighlightedNode(this.nodeShape,this.mcColor);draw.setVisibility(e,false);this.svgLayerGroup.appendChild(e);return e};SingleLineSeriesViewer.prototype.enableNodeTrigger=function(e){if(this.isContinual){return}var t=draw.createGroup();for(var n=0;n<this.nodes.length;n=n+4){var r=nodeDrawer.drawTrigger(this.nodes[n],this.nodes[n+1],n/4);t.appendChild(r)}this.svgTriggerGroup.appendChild(t);var i=new TriggerControl(this.tipControl,this.seriesName,this.mcColor);i.enableNodeTrigger(t,this.seriesName,this.mcColor,e,this.nodes)};SingleLineSeriesViewer.prototype.enableRoutineTrace=function(e){if(!this.isContinual){return}var t=draw.createStraightLines(this.nodes,4,0);draw.setStrokeFill(t,this.mcColor.strokeColor,20,"none");draw.setVisibility(t,false);t.setAttributeNS(null,"pointer-events","stroke");this.svgTriggerGroup.appendChild(t);var n=new TriggerControl(this.tipControl,this.seriesName,this.mcColor);n.enableRoutineTrace(this.htmlContainer,this.seriesName,this.mcColor,this.nodes,t,this.constantInterval,this.xDrawInfo)};BasicPieDataViewer.prototype.draw=function(){var e=this.analyze();var t=new RandomPicker;var n=draw.createGroup();var r=draw.createGroup();var i=new TipControl(this.htmlContainer,0,true);i.createTip();var s=new PieDataLabelSlotsController;s.generateEmptySlots(19,this.center,this.radiusForLabel,this.svg);var o=[];var u=[];for(var a=0;a<e.length;a=a+4){var f=e[a];var l=e[a+1];var c=e[a+2];var h=e[a+3];var p=new SinglePieSeriesViewer(n,this.htmlContainer,i,r,f,l,this.radiusForLabel,this.radiusForPie,this.radiusForConnectionLineTurn,this.center,c,t.pickSeriesColor(),h,s);var d=p.getConnectorInfo();if(d.isLeft){o.push(d)}else{u.push(d)}p.draw()}if(!this.input.noDataLabel){o=s.processConnectorInfo(o,true);u=s.processConnectorInfo(u,false);for(var a=0;a<o.length;a++){n.appendChild(s.createConnectionLine(o[a]));n.appendChild(s.createTextInSlot(o[a].text,o[a].slotIdx,true))}for(var a=0;a<u.length;a++){n.appendChild(s.createConnectionLine(u[a]));n.appendChild(s.createTextInSlot(u[a].text,u[a].slotIdx,false))}}this.svg.appendChild(n);this.svgTrigger.appendChild(r)};BasicPieDataViewer.prototype.analyze=function(){var e=[];var t=0;for(var n=0;n<this.input.series.length;n++){var r=this.input.series[n][1];var i=r/this.total*360;e.push(t);e.push(t+i);e.push(this.input.series[n][0]);e.push(r);t=t+i}return e};SinglePieSeriesViewer.prototype.draw=function(){var e=draw.createArcOfCircle(this.center[0],this.center[1],this.radiusForPie,this.startAngle,this.endAngle);draw.setStrokeFill(e,"white",1.5,this.mcColor.fillColor);this.svg.appendChild(e);this.enablePieSliceTrigger()};SinglePieSeriesViewer.prototype.getConnectorInfo=function(){var e=util.polarToCartesian(this.center[0],this.center[1],this.radiusForPie,(this.endAngle+this.startAngle)/2);var t=util.polarToCartesian(this.center[0],this.center[1],this.radiusForConnectionLineTurn,(this.endAngle+this.startAngle)/2);var n=false;if(e[0]<this.center[0]){n=true}return{position:e,connectionLineTurnPos:t,isLeft:n,slotIdx:-1,text:this.seriesName+": "+this.dataY,mcColor:this.mcColor}};SinglePieSeriesViewer.prototype.enablePieSliceTrigger=function(){var e=draw.createArcOfCircle(this.center[0],this.center[1],this.radiusForPie,this.startAngle,this.endAngle);draw.setStrokeFill(e,false,false,"white");draw.setVisibility(e,false);draw.setPointerEvent(e,true,false);this.svgTrigger.appendChild(e);var t=util.polarToCartesian(this.center[0],this.center[1],this.radiusForPie/2,(this.endAngle+this.startAngle)/2);var n=new PieSliceTriggerControl;n.enablePieSliceTrigger(e,t,this.tipControl,this.seriesName,this.mcColor,this.dataY)};PieDataLabelSlotsController.prototype.generateEmptySlots=function(e,t,n,r){function i(r){var i=[];var s=n*2;var o=0;var u=Math.pow(n,2);while(s-(e*o+e/5)>0){var a=e*o+e/5;var f=Math.pow(n-a,2);var l=Math.sqrt(u-f);var c;if(r){c=t[0]-l}else{c=t[0]+l}var h=t[1]+(a-n);i.push(o);i.push(c);i.push(h);i.push(false);o++}return i}this.leftSlots=i(true);this.rightSlots=i(false)};PieDataLabelSlotsController.prototype.processConnectorInfo=function(e,t){function o(e){e.sort(function(e,t){if(e.position[1]<t.position[1]){return-1}else{return 1}})}function u(t,n){var r=-1;var i=[];for(var s=t-1;s>0;s--){i.push(e[s]);if(e[s].slotIdx-e[s-1].slotIdx>1){r=e[s].slotIdx;break}}for(var s=0;s<i.length;s++){i[s].slotIdx=i[s].slotIdx-1}n[r+3]=true;t.slotIdx=n.length-1}o(e);var n;if(t){n=this.leftSlots}else{n=this.rightSlots}for(var r=0;r<e.length;r++){var i=e[r];var s=this.findNearestAvailableSlotIdx(i.position[0],i.position[1],n);if(s!==-1){i.slotIdx=s}else{u(r)}}return e};PieDataLabelSlotsController.prototype.findNearestAvailableSlotIdx=function(e,t,n){function u(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var r=-1;var i=1e4;for(var s=0;s<n.length;s=s+4){if(n[s+3]){continue}var o=u(e,t,n[s+1],n[s+2]);if(o<i){i=o;r=s}}if(r===-1){return-1}n[r+3]=true;return r/4};PieDataLabelSlotsController.prototype.createConnectionLine=function(e){var t;if(e.isLeft){t=this.leftSlots}else{t=this.rightSlots}var n=[e.position[0],e.position[1],e.connectionLineTurnPos[0],e.connectionLineTurnPos[1],t[e.slotIdx*4+1],t[e.slotIdx*4+2]];var r=draw.createQuadraticBezierCurve(n);draw.setStrokeFill(r,e.mcColor.strokeColor,1,"none");return r};PieDataLabelSlotsController.prototype.createTextInSlot=function(e,t,n){var r;if(n){r=this.leftSlots;return draw.createText(r[t*4+1]-5,r[t*4+2],e,14,n?"end":"start","middle")}else{r=this.rightSlots;return draw.createText(r[t*4+1]+5,r[t*4+2],e,14,n?"end":"start","middle")}};BasicLineRegularDataViewer.prototype.draw=function(){var e=draw.createGroup();var t=draw.createGroup();var n=new RandomPicker;var r=new TipControl(this.htmlContainer,7,false);r.createTip();for(var i=0;i<this.input.series.length;i++){var s=this.input.series[i][0];var o=this.analyzeSingleSeriesData(this.input.series[i][1]);var u=new SingleLineSeriesViewer(this.htmlContainer,e,t,o,n.pickNodeShape(),n.pickSeriesColor(),this.isContinual,this.input.interval,s,r,this.xDrawInfo,this.yDrawInfo);u.draw()}this.svg.appendChild(e);this.svgTrigger.appendChild(t)};BasicLineRegularDataViewer.prototype.analyzeSingleSeriesData=function(e){var t=[];var n=this.input.interval;var r=this.input.start;for(var i=0;i<e.length;i++){var s=this.xDrawInfo.startPoint+i*n*this.xDrawInfo.pixelPerData;var o=this.yDrawInfo.startPoint-(e[i]-this.yDrawInfo.min)*this.yDrawInfo.pixelPerData;t.push(s);t.push(o);t.push(r+n*i);t.push(e[i])}return t};var threeModels=function(){function e(e,t,n,r,i,s,o,u,a){this.translate=e;this.scale=t;this.modelMatrix=mat4.create();this.MVMatrix=mat4.create();this.MVPMatrix=mat4.create();this.normalMatrix=mat3.create();this.isFocus=false;this.identityMatrix=mat4.create();this.mcColor=n;this.fillColorArray=colors.convertToWebGLcolorArray(n.fillColor);this.strokeColorArray=colors.convertToWebGLcolorArray(n.strokeColor);this.label=i;this.dataY=s+" -- "+r;this.staticTipControl=new StaticTipControl(o,u,a);this.staticTipControl.createTip()}function n(){return t!==0}function r(e,t,n){this.translate=e;this.modelMatrix=mat4.create();this.MVMatrix=mat4.create();this.MVPMatrix=mat4.create();this.identityMatrix=mat4.create();this.scale=t;this.texture=null}e.prototype.calculateModelMatrix=function(e){mat4.rotate(this.modelMatrix,this.identityMatrix,e,[0,1,0]);mat4.translate(this.modelMatrix,this.modelMatrix,this.translate);mat4.scale(this.modelMatrix,this.modelMatrix,this.scale)};var t=0;e.prototype.toggleFocus=function(){if(this.isFocus){this.cancelFocus()}else{this.setFocus()}return this.isFocus};e.prototype.setFocus=function(){t++;this.isFocus=true};e.prototype.cancelFocus=function(){t--;this.isFocus=false};r.prototype.connectWithTexture=function(e,t){this.texture=webglUtil.prepareLabelTexture(e,t)};r.prototype.calculateModelMatrix=function(e){mat4.rotate(this.modelMatrix,this.identityMatrix,e,[0,1,0]);mat4.translate(this.modelMatrix,this.modelMatrix,this.translate);mat4.scale(this.modelMatrix,this.modelMatrix,this.scale)};return{CuboidModel:e,isAnythingFocused:n,PlaneModel:r}}();(function(e){"use strict";var t={};if(typeof exports==="undefined"){if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){t.exports={};define(function(){return t.exports})}else{t.exports=typeof window!=="undefined"?window:e}}else{t.exports=exports}(function(e){if(!t){var t=1e-6}if(!n){var n=typeof Float32Array!=="undefined"?Float32Array:Array}if(!r){var r=Math.random}var i={};i.setMatrixArrayType=function(e){n=e};if(typeof e!=="undefined"){e.glMatrix=i}var s=Math.PI/180;i.toRadian=function(e){return e*s};var o={};o.create=function(){var e=new n(2);e[0]=0;e[1]=0;return e};o.clone=function(e){var t=new n(2);t[0]=e[0];t[1]=e[1];return t};o.fromValues=function(e,t){var r=new n(2);r[0]=e;r[1]=t;return r};o.copy=function(e,t){e[0]=t[0];e[1]=t[1];return e};o.set=function(e,t,n){e[0]=t;e[1]=n;return e};o.add=function(e,t,n){e[0]=t[0]+n[0];e[1]=t[1]+n[1];return e};o.subtract=function(e,t,n){e[0]=t[0]-n[0];e[1]=t[1]-n[1];return e};o.sub=o.subtract;o.multiply=function(e,t,n){e[0]=t[0]*n[0];e[1]=t[1]*n[1];return e};o.mul=o.multiply;o.divide=function(e,t,n){e[0]=t[0]/n[0];e[1]=t[1]/n[1];return e};o.div=o.divide;o.min=function(e,t,n){e[0]=Math.min(t[0],n[0]);e[1]=Math.min(t[1],n[1]);return e};o.max=function(e,t,n){e[0]=Math.max(t[0],n[0]);e[1]=Math.max(t[1],n[1]);return e};o.scale=function(e,t,n){e[0]=t[0]*n;e[1]=t[1]*n;return e};o.scaleAndAdd=function(e,t,n,r){e[0]=t[0]+n[0]*r;e[1]=t[1]+n[1]*r;return e};o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)};o.dist=o.distance;o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r};o.sqrDist=o.squaredDistance;o.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)};o.len=o.length;o.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n};o.sqrLen=o.squaredLength;o.negate=function(e,t){e[0]=-t[0];e[1]=-t[1];return e};o.normalize=function(e,t){var n=t[0],r=t[1];var i=n*n+r*r;if(i>0){i=1/Math.sqrt(i);e[0]=t[0]*i;e[1]=t[1]*i}return e};o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]};o.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];e[0]=e[1]=0;e[2]=r;return e};o.lerp=function(e,t,n,r){var i=t[0],s=t[1];e[0]=i+r*(n[0]-i);e[1]=s+r*(n[1]-s);return e};o.random=function(e,t){t=t||1;var n=r()*2*Math.PI;e[0]=Math.cos(n)*t;e[1]=Math.sin(n)*t;return e};o.transformMat2=function(e,t,n){var r=t[0],i=t[1];e[0]=n[0]*r+n[2]*i;e[1]=n[1]*r+n[3]*i;return e};o.transformMat2d=function(e,t,n){var r=t[0],i=t[1];e[0]=n[0]*r+n[2]*i+n[4];e[1]=n[1]*r+n[3]*i+n[5];return e};o.transformMat3=function(e,t,n){var r=t[0],i=t[1];e[0]=n[0]*r+n[3]*i+n[6];e[1]=n[1]*r+n[4]*i+n[7];return e};o.transformMat4=function(e,t,n){var r=t[0],i=t[1];e[0]=n[0]*r+n[4]*i+n[12];e[1]=n[1]*r+n[5]*i+n[13];return e};o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;if(!n){n=2}if(!r){r=0}if(i){a=Math.min(i*n+r,t.length)}else{a=t.length}for(u=r;u<a;u+=n){e[0]=t[u];e[1]=t[u+1];s(e,e,o);t[u]=e[0];t[u+1]=e[1]}return t}}();o.str=function(e){return"vec2("+e[0]+", "+e[1]+")"};if(typeof e!=="undefined"){e.vec2=o}var u={};u.create=function(){var e=new n(3);e[0]=0;e[1]=0;e[2]=0;return e};u.clone=function(e){var t=new n(3);t[0]=e[0];t[1]=e[1];t[2]=e[2];return t};u.fromValues=function(e,t,r){var i=new n(3);i[0]=e;i[1]=t;i[2]=r;return i};u.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];return e};u.set=function(e,t,n,r){e[0]=t;e[1]=n;e[2]=r;return e};u.add=function(e,t,n){e[0]=t[0]+n[0];e[1]=t[1]+n[1];e[2]=t[2]+n[2];return e};u.subtract=function(e,t,n){e[0]=t[0]-n[0];e[1]=t[1]-n[1];e[2]=t[2]-n[2];return e};u.sub=u.subtract;u.multiply=function(e,t,n){e[0]=t[0]*n[0];e[1]=t[1]*n[1];e[2]=t[2]*n[2];return e};u.mul=u.multiply;u.divide=function(e,t,n){e[0]=t[0]/n[0];e[1]=t[1]/n[1];e[2]=t[2]/n[2];return e};u.div=u.divide;u.min=function(e,t,n){e[0]=Math.min(t[0],n[0]);e[1]=Math.min(t[1],n[1]);e[2]=Math.min(t[2],n[2]);return e};u.max=function(e,t,n){e[0]=Math.max(t[0],n[0]);e[1]=Math.max(t[1],n[1]);e[2]=Math.max(t[2],n[2]);return e};u.scale=function(e,t,n){e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;return e};u.scaleAndAdd=function(e,t,n,r){e[0]=t[0]+n[0]*r;e[1]=t[1]+n[1]*r;e[2]=t[2]+n[2]*r;return e};u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)};u.dist=u.distance;u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i};u.sqrDist=u.squaredDistance;u.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)};u.len=u.length;u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r};u.sqrLen=u.squaredLength;u.negate=function(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];return e};u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2];var s=n*n+r*r+i*i;if(s>0){s=1/Math.sqrt(s);e[0]=t[0]*s;e[1]=t[1]*s;e[2]=t[2]*s}return e};u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]};u.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];e[0]=i*a-s*u;e[1]=s*o-r*a;e[2]=r*u-i*o;return e};u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];e[0]=i+r*(n[0]-i);e[1]=s+r*(n[1]-s);e[2]=o+r*(n[2]-o);return e};u.random=function(e,t){t=t||1;var n=r()*2*Math.PI;var i=r()*2-1;var s=Math.sqrt(1-i*i)*t;e[0]=Math.cos(n)*s;e[1]=Math.sin(n)*s;e[2]=i*t;return e};u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];e[0]=n[0]*r+n[4]*i+n[8]*s+n[12];e[1]=n[1]*r+n[5]*i+n[9]*s+n[13];e[2]=n[2]*r+n[6]*i+n[10]*s+n[14];return e};u.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];e[0]=r*n[0]+i*n[3]+s*n[6];e[1]=r*n[1]+i*n[4]+s*n[7];e[2]=r*n[2]+i*n[5]+s*n[8];return e};u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;e[0]=l*f+p*-o+c*-a-h*-u;e[1]=c*f+p*-u+h*-o-l*-a;e[2]=h*f+p*-a+l*-u-c*-o;return e};u.rotateX=function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0];i[1]=t[1]-n[1];i[2]=t[2]-n[2];s[0]=i[0];s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r);s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r);e[0]=s[0]+n[0];e[1]=s[1]+n[1];e[2]=s[2]+n[2];return e};u.rotateY=function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0];i[1]=t[1]-n[1];i[2]=t[2]-n[2];s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r);s[1]=i[1];s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r);e[0]=s[0]+n[0];e[1]=s[1]+n[1];e[2]=s[2]+n[2];return e};u.rotateZ=function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0];i[1]=t[1]-n[1];i[2]=t[2]-n[2];s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r);s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r);s[2]=i[2];e[0]=s[0]+n[0];e[1]=s[1]+n[1];e[2]=s[2]+n[2];return e};u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;if(!n){n=3}if(!r){r=0}if(i){a=Math.min(i*n+r,t.length)}else{a=t.length}for(u=r;u<a;u+=n){e[0]=t[u];e[1]=t[u+1];e[2]=t[u+2];s(e,e,o);t[u]=e[0];t[u+1]=e[1];t[u+2]=e[2]}return t}}();u.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"};if(typeof e!=="undefined"){e.vec3=u}var a={};a.create=function(){var e=new n(4);e[0]=0;e[1]=0;e[2]=0;e[3]=0;return e};a.clone=function(e){var t=new n(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t};a.fromValues=function(e,t,r,i){var s=new n(4);s[0]=e;s[1]=t;s[2]=r;s[3]=i;return s};a.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e};a.set=function(e,t,n,r,i){e[0]=t;e[1]=n;e[2]=r;e[3]=i;return e};a.add=function(e,t,n){e[0]=t[0]+n[0];e[1]=t[1]+n[1];e[2]=t[2]+n[2];e[3]=t[3]+n[3];return e};a.subtract=function(e,t,n){e[0]=t[0]-n[0];e[1]=t[1]-n[1];e[2]=t[2]-n[2];e[3]=t[3]-n[3];return e};a.sub=a.subtract;a.multiply=function(e,t,n){e[0]=t[0]*n[0];e[1]=t[1]*n[1];e[2]=t[2]*n[2];e[3]=t[3]*n[3];return e};a.mul=a.multiply;a.divide=function(e,t,n){e[0]=t[0]/n[0];e[1]=t[1]/n[1];e[2]=t[2]/n[2];e[3]=t[3]/n[3];return e};a.div=a.divide;a.min=function(e,t,n){e[0]=Math.min(t[0],n[0]);e[1]=Math.min(t[1],n[1]);e[2]=Math.min(t[2],n[2]);e[3]=Math.min(t[3],n[3]);return e};a.max=function(e,t,n){e[0]=Math.max(t[0],n[0]);e[1]=Math.max(t[1],n[1]);e[2]=Math.max(t[2],n[2]);e[3]=Math.max(t[3],n[3]);return e};a.scale=function(e,t,n){e[0]=t[0]*n;e[1]=t[1]*n;e[2]=t[2]*n;e[3]=t[3]*n;return e};a.scaleAndAdd=function(e,t,n,r){e[0]=t[0]+n[0]*r;e[1]=t[1]+n[1]*r;e[2]=t[2]+n[2]*r;e[3]=t[3]+n[3]*r;return e};a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)};a.dist=a.distance;a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s};a.sqrDist=a.squaredDistance;a.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)};a.len=a.length;a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i};a.sqrLen=a.squaredLength;a.negate=function(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=-t[3];return e};a.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3];var o=n*n+r*r+i*i+s*s;if(o>0){o=1/Math.sqrt(o);e[0]=t[0]*o;e[1]=t[1]*o;e[2]=t[2]*o;e[3]=t[3]*o}return e};a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]};a.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];e[0]=i+r*(n[0]-i);e[1]=s+r*(n[1]-s);e[2]=o+r*(n[2]-o);e[3]=u+r*(n[3]-u);return e};a.random=function(e,t){t=t||1;e[0]=r();e[1]=r();e[2]=r();e[3]=r();a.normalize(e,e);a.scale(e,e,t);return e};a.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o;e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o;e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o;e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o;return e};a.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;e[0]=l*f+p*-o+c*-a-h*-u;e[1]=c*f+p*-u+h*-o-l*-a;e[2]=h*f+p*-a+l*-u-c*-o;return e};a.forEach=function(){var e=a.create();return function(t,n,r,i,s,o){var u,a;if(!n){n=4}if(!r){r=0}if(i){a=Math.min(i*n+r,t.length)}else{a=t.length}for(u=r;u<a;u+=n){e[0]=t[u];e[1]=t[u+1];e[2]=t[u+2];e[3]=t[u+3];s(e,e,o);t[u]=e[0];t[u+1]=e[1];t[u+2]=e[2];t[u+3]=e[3]}return t}}();a.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};if(typeof e!=="undefined"){e.vec4=a}var f={};f.create=function(){var e=new n(4);e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e};f.clone=function(e){var t=new n(4);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t};f.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e};f.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;return e};f.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2];e[2]=n}else{e[0]=t[0];e[1]=t[2];e[2]=t[1];e[3]=t[3]}return e};f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;if(!o){return null}o=1/o;e[0]=s*o;e[1]=-r*o;e[2]=-i*o;e[3]=n*o;return e};f.adjoint=function(e,t){var n=t[0];e[0]=t[3];e[1]=-t[1];e[2]=-t[2];e[3]=n;return e};f.determinant=function(e){return e[0]*e[3]-e[2]*e[1]};f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];var u=n[0],a=n[1],f=n[2],l=n[3];e[0]=r*u+s*a;e[1]=i*u+o*a;e[2]=r*f+s*l;e[3]=i*f+o*l;return e};f.mul=f.multiply;f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);e[0]=r*a+s*u;e[1]=i*a+o*u;e[2]=r*-u+s*a;e[3]=i*-u+o*a;return e};f.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];e[0]=r*u;e[1]=i*u;e[2]=s*a;e[3]=o*a;return e};f.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};f.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))};f.LDU=function(e,t,n,r){e[2]=r[2]/r[0];n[0]=r[0];n[1]=r[1];n[3]=r[3]-e[2]*n[1];return[e,t,n]};if(typeof e!=="undefined"){e.mat2=f}var l={};l.create=function(){var e=new n(6);e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e};l.clone=function(e){var t=new n(6);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t};l.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e};l.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=1;e[4]=0;e[5]=0;return e};l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5];var a=n*s-r*i;if(!a){return null}a=1/a;e[0]=s*a;e[1]=-r*a;e[2]=-i*a;e[3]=n*a;e[4]=(i*u-s*o)*a;e[5]=(r*o-n*u)*a;return e};l.determinant=function(e){return e[0]*e[3]-e[1]*e[2]};l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];e[0]=r*f+s*l;e[1]=i*f+o*l;e[2]=r*c+s*h;e[3]=i*c+o*h;e[4]=r*p+s*d+u;e[5]=i*p+o*d+a;return e};l.mul=l.multiply;l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);e[0]=r*l+s*f;e[1]=i*l+o*f;e[2]=r*-f+s*l;e[3]=i*-f+o*l;e[4]=u;e[5]=a;return e};l.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1];e[0]=r*f;e[1]=i*f;e[2]=s*l;e[3]=o*l;e[4]=u;e[5]=a;return e};l.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1];e[0]=r;e[1]=i;e[2]=s;e[3]=o;e[4]=r*f+s*l+u;e[5]=i*f+o*l+a;return e};l.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"};l.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)};if(typeof e!=="undefined"){e.mat2d=l}var c={};c.create=function(){var e=new n(9);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};c.fromMat4=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[4];e[4]=t[5];e[5]=t[6];e[6]=t[8];e[7]=t[9];e[8]=t[10];return e};c.clone=function(e){var t=new n(9);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t};c.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e};c.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3];e[2]=t[6];e[3]=n;e[5]=t[7];e[6]=r;e[7]=i}else{e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8]}return e};c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;if(!d){return null}d=1/d;e[0]=c*d;e[1]=(-l*r+i*f)*d;e[2]=(u*r-i*o)*d;e[3]=h*d;e[4]=(l*n-i*a)*d;e[5]=(-u*n+i*s)*d;e[6]=p*d;e[7]=(-f*n+r*a)*d;e[8]=(o*n-r*s)*d;return e};c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];e[0]=o*l-u*f;e[1]=i*f-r*l;e[2]=r*u-i*o;e[3]=u*a-s*l;e[4]=n*l-i*a;e[5]=i*s-n*u;e[6]=s*f-o*a;e[7]=r*a-n*f;e[8]=n*o-r*s;return e};c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)};c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];e[0]=h*r+p*o+d*f;e[1]=h*i+p*u+d*l;e[2]=h*s+p*a+d*c;e[3]=v*r+m*o+g*f;e[4]=v*i+m*u+g*l;e[5]=v*s+m*a+g*c;e[6]=y*r+b*o+w*f;e[7]=y*i+b*u+w*l;e[8]=y*s+b*a+w*c;return e};c.mul=c.multiply;c.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];e[0]=r;e[1]=i;e[2]=s;e[3]=o;e[4]=u;e[5]=a;e[6]=h*r+p*o+f;e[7]=h*i+p*u+l;e[8]=h*s+p*a+c;return e};c.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);e[0]=p*r+h*o;e[1]=p*i+h*u;e[2]=p*s+h*a;e[3]=p*o-h*r;e[4]=p*u-h*i;e[5]=p*a-h*s;e[6]=f;e[7]=l;e[8]=c;return e};c.scale=function(e,t,n){var r=n[0],i=n[1];e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=i*t[3];e[4]=i*t[4];e[5]=i*t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];return e};c.fromMat2d=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=0;e[3]=t[2];e[4]=t[3];e[5]=0;e[6]=t[4];e[7]=t[5];e[8]=1;return e};c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=r*o,c=r*u,h=i*o,p=i*u,d=i*a,v=s*o,m=s*u,g=s*a;e[0]=1-c-d;e[3]=l-g;e[6]=h+m;e[1]=l+g;e[4]=1-f-d;e[7]=p-v;e[2]=h-m;e[5]=p+v;e[8]=1-f-c;return e};c.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;if(!O){return null}O=1/O;e[0]=(u*A-a*L+f*k)*O;e[1]=(a*C-o*A-f*N)*O;e[2]=(o*L-u*C+f*T)*O;e[3]=(i*L-r*A-s*k)*O;e[4]=(n*A-i*C+s*N)*O;e[5]=(r*C-n*L-s*T)*O;e[6]=(v*x-m*S+g*E)*O;e[7]=(m*w-d*x-g*b)*O;e[8]=(d*S-v*w+g*y)*O;return e};c.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"};c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))};if(typeof e!=="undefined"){e.mat3=c}var h={};h.create=function(){var e=new n(16);e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.clone=function(e){var t=new n(16);t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];t[9]=e[9];t[10]=e[10];t[11]=e[11];t[12]=e[12];t[13]=e[13];t[14]=e[14];t[15]=e[15];return t};h.copy=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e};h.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=1;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=1;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=n;e[6]=t[9];e[7]=t[13];e[8]=r;e[9]=s;e[11]=t[14];e[12]=i;e[13]=o;e[14]=u}else{e[0]=t[0];e[1]=t[4];e[2]=t[8];e[3]=t[12];e[4]=t[1];e[5]=t[5];e[6]=t[9];e[7]=t[13];e[8]=t[2];e[9]=t[6];e[10]=t[10];e[11]=t[14];e[12]=t[3];e[13]=t[7];e[14]=t[11];e[15]=t[15]}return e};h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;if(!O){return null}O=1/O;e[0]=(u*A-a*L+f*k)*O;e[1]=(i*L-r*A-s*k)*O;e[2]=(v*x-m*S+g*E)*O;e[3]=(h*S-c*x-p*E)*O;e[4]=(a*C-o*A-f*N)*O;e[5]=(n*A-i*C+s*N)*O;e[6]=(m*w-d*x-g*b)*O;e[7]=(l*x-h*w+p*b)*O;e[8]=(o*L-u*C+f*T)*O;e[9]=(r*C-n*L-s*T)*O;e[10]=(d*S-v*w+g*y)*O;e[11]=(c*w-l*S-p*y)*O;e[12]=(u*N-o*k-a*T)*O;e[13]=(n*k-r*N+i*T)*O;e[14]=(v*b-d*E-m*y)*O;e[15]=(l*E-c*b+h*y)*O;return e};h.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h);e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h));e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a);e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a));e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h));e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h);e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a));e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a);e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c);e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c));e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u);e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u));e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c));e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c);e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u));e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u);return e};h.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x};h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15];var b=n[0],w=n[1],E=n[2],S=n[3];e[0]=b*r+w*u+E*c+S*v;e[1]=b*i+w*a+E*h+S*m;e[2]=b*s+w*f+E*p+S*g;e[3]=b*o+w*l+E*d+S*y;b=n[4];w=n[5];E=n[6];S=n[7];e[4]=b*r+w*u+E*c+S*v;e[5]=b*i+w*a+E*h+S*m;e[6]=b*s+w*f+E*p+S*g;e[7]=b*o+w*l+E*d+S*y;b=n[8];w=n[9];E=n[10];S=n[11];e[8]=b*r+w*u+E*c+S*v;e[9]=b*i+w*a+E*h+S*m;e[10]=b*s+w*f+E*p+S*g;e[11]=b*o+w*l+E*d+S*y;b=n[12];w=n[13];E=n[14];S=n[15];e[12]=b*r+w*u+E*c+S*v;e[13]=b*i+w*a+E*h+S*m;e[14]=b*s+w*f+E*p+S*g;e[15]=b*o+w*l+E*d+S*y;return e};h.mul=h.multiply;h.translate=function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g;if(t===e){e[12]=t[0]*r+t[4]*i+t[8]*s+t[12];e[13]=t[1]*r+t[5]*i+t[9]*s+t[13];e[14]=t[2]*r+t[6]*i+t[10]*s+t[14];e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]}else{o=t[0];u=t[1];a=t[2];f=t[3];l=t[4];c=t[5];h=t[6];p=t[7];d=t[8];v=t[9];m=t[10];g=t[11];e[0]=o;e[1]=u;e[2]=a;e[3]=f;e[4]=l;e[5]=c;e[6]=h;e[7]=p;e[8]=d;e[9]=v;e[10]=m;e[11]=g;e[12]=o*r+l*i+d*s+t[12];e[13]=u*r+c*i+v*s+t[13];e[14]=a*r+h*i+m*s+t[14];e[15]=f*r+p*i+g*s+t[15]}return e};h.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];e[0]=t[0]*r;e[1]=t[1]*r;e[2]=t[2]*r;e[3]=t[3]*r;e[4]=t[4]*i;e[5]=t[5]*i;e[6]=t[6]*i;e[7]=t[7]*i;e[8]=t[8]*s;e[9]=t[9]*s;e[10]=t[10]*s;e[11]=t[11]*s;e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e};h.rotate=function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;if(Math.abs(a)<t){return null}a=1/a;s*=a;o*=a;u*=a;f=Math.sin(r);l=Math.cos(r);c=1-l;h=n[0];p=n[1];d=n[2];v=n[3];m=n[4];g=n[5];y=n[6];b=n[7];w=n[8];E=n[9];S=n[10];x=n[11];T=s*s*c+l;N=o*s*c+u*f;C=u*s*c-o*f;k=s*o*c-u*f;L=o*o*c+l;A=u*o*c+s*f;O=s*u*c+o*f;M=o*u*c-s*f;_=u*u*c+l;e[0]=h*T+m*N+w*C;e[1]=p*T+g*N+E*C;e[2]=d*T+y*N+S*C;e[3]=v*T+b*N+x*C;e[4]=h*k+m*L+w*A;e[5]=p*k+g*L+E*A;e[6]=d*k+y*L+S*A;e[7]=v*k+b*L+x*A;e[8]=h*O+m*M+w*_;e[9]=p*O+g*M+E*_;e[10]=d*O+y*M+S*_;e[11]=v*O+b*M+x*_;if(n!==e){e[12]=n[12];e[13]=n[13];e[14]=n[14];e[15]=n[15]}return e};h.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];if(t!==e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[4]=s*i+f*r;e[5]=o*i+l*r;e[6]=u*i+c*r;e[7]=a*i+h*r;e[8]=f*i-s*r;e[9]=l*i-o*r;e[10]=c*i-u*r;e[11]=h*i-a*r;return e};h.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];if(t!==e){e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*i-f*r;e[1]=o*i-l*r;e[2]=u*i-c*r;e[3]=a*i-h*r;e[8]=s*r+f*i;e[9]=o*r+l*i;e[10]=u*r+c*i;e[11]=a*r+h*i;return e};h.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];if(t!==e){e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15]}e[0]=s*i+f*r;e[1]=o*i+l*r;e[2]=u*i+c*r;e[3]=a*i+h*r;e[4]=f*i-s*r;e[5]=l*i-o*r;e[6]=c*i-u*r;e[7]=h*i-a*r;return e};h.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;e[0]=1-(p+v);e[1]=c+y;e[2]=h-g;e[3]=0;e[4]=c-y;e[5]=1-(l+v);e[6]=d+m;e[7]=0;e[8]=h+g;e[9]=d-m;e[10]=1-(l+p);e[11]=0;e[12]=n[0];e[13]=n[1];e[14]=n[2];e[15]=1;return e};h.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=r*o,c=r*u,h=i*o,p=i*u,d=i*a,v=s*o,m=s*u,g=s*a;e[0]=1-c-d;e[1]=l+g;e[2]=h-m;e[3]=0;e[4]=l-g;e[5]=1-f-d;e[6]=p+v;e[7]=0;e[8]=h+m;e[9]=p-v;e[10]=1-f-c;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return e};h.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);e[0]=s*2*u;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s*2*a;e[6]=0;e[7]=0;e[8]=(n+t)*u;e[9]=(i+r)*a;e[10]=(o+s)*f;e[11]=-1;e[12]=0;e[13]=0;e[14]=o*s*2*f;e[15]=0;return e};h.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);e[0]=s/n;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=s;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(i+r)*o;e[11]=-1;e[12]=0;e[13]=0;e[14]=2*i*r*o;e[15]=0;return e};h.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);e[0]=-2*u;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=-2*a;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=2*f;e[11]=0;e[12]=(t+n)*u;e[13]=(i+r)*a;e[14]=(o+s)*f;e[15]=1;return e};h.lookAt=function(e,n,r,i){var s,o,u,a,f,l,c,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];if(Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t){return h.identity(e)}c=m-S;p=g-x;d=y-T;v=1/Math.sqrt(c*c+p*p+d*d);c*=v;p*=v;d*=v;s=w*d-E*p;o=E*c-b*d;u=b*p-w*c;v=Math.sqrt(s*s+o*o+u*u);if(!v){s=0;o=0;u=0}else{v=1/v;s*=v;o*=v;u*=v}a=p*u-d*o;f=d*s-c*u;l=c*o-p*s;v=Math.sqrt(a*a+f*f+l*l);if(!v){a=0;f=0;l=0}else{v=1/v;a*=v;f*=v;l*=v}e[0]=s;e[1]=a;e[2]=c;e[3]=0;e[4]=o;e[5]=f;e[6]=p;e[7]=0;e[8]=u;e[9]=l;e[10]=d;e[11]=0;e[12]=-(s*m+o*g+u*y);e[13]=-(a*m+f*g+l*y);e[14]=-(c*m+p*g+d*y);e[15]=1;return e};h.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"};h.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))};if(typeof e!=="undefined"){e.mat4=h}var p={};p.create=function(){var e=new n(4);e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e};p.rotationTo=function(){var e=u.create();var t=u.fromValues(1,0,0);var n=u.fromValues(0,1,0);return function(r,i,s){var o=u.dot(i,s);if(o<-.999999){u.cross(e,t,i);if(u.length(e)<1e-6)u.cross(e,n,i);u.normalize(e,e);p.setAxisAngle(r,e,Math.PI);return r}else if(o>.999999){r[0]=0;r[1]=0;r[2]=0;r[3]=1;return r}else{u.cross(e,i,s);r[0]=e[0];r[1]=e[1];r[2]=e[2];r[3]=1+o;return p.normalize(r,r)}}}();p.setAxes=function(){var e=c.create();return function(t,n,r,i){e[0]=r[0];e[3]=r[1];e[6]=r[2];e[1]=i[0];e[4]=i[1];e[7]=i[2];e[2]=-n[0];e[5]=-n[1];e[8]=-n[2];return p.normalize(t,p.fromMat3(t,e))}}();p.clone=a.clone;p.fromValues=a.fromValues;p.copy=a.copy;p.set=a.set;p.identity=function(e){e[0]=0;e[1]=0;e[2]=0;e[3]=1;return e};p.setAxisAngle=function(e,t,n){n=n*.5;var r=Math.sin(n);e[0]=r*t[0];e[1]=r*t[1];e[2]=r*t[2];e[3]=Math.cos(n);return e};p.add=a.add;p.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];e[0]=r*l+o*u+i*f-s*a;e[1]=i*l+o*a+s*u-r*f;e[2]=s*l+o*f+r*a-i*u;e[3]=o*l-r*u-i*a-s*f;return e};p.mul=p.multiply;p.scale=a.scale;p.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);e[0]=r*a+o*u;e[1]=i*a+s*u;e[2]=s*a-i*u;e[3]=o*a-r*u;return e};p.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);e[0]=r*a-s*u;e[1]=i*a+o*u;e[2]=s*a+r*u;e[3]=o*a-i*u;return e};p.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);e[0]=r*a+i*u;e[1]=i*a-r*u;e[2]=s*a+o*u;e[3]=o*a-s*u;return e};p.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];e[0]=n;e[1]=r;e[2]=i;e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i));return e};p.dot=a.dot;p.lerp=a.lerp;p.slerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3];var h,p,d,v,m;p=i*a+s*f+o*l+u*c;if(p<0){p=-p;a=-a;f=-f;l=-l;c=-c}if(1-p>1e-6){h=Math.acos(p);d=Math.sin(h);v=Math.sin((1-r)*h)/d;m=Math.sin(r*h)/d}else{v=1-r;m=r}e[0]=v*i+m*a;e[1]=v*s+m*f;e[2]=v*o+m*l;e[3]=v*u+m*c;return e};p.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;e[0]=-n*u;e[1]=-r*u;e[2]=-i*u;e[3]=s*u;return e};p.conjugate=function(e,t){e[0]=-t[0];e[1]=-t[1];e[2]=-t[2];e[3]=t[3];return e};p.length=a.length;p.len=p.length;p.squaredLength=a.squaredLength;p.sqrLen=p.squaredLength;p.normalize=a.normalize;p.fromMat3=function(e,t){var n=t[0]+t[4]+t[8];var r;if(n>0){r=Math.sqrt(n+1);e[3]=.5*r;r=.5/r;e[0]=(t[7]-t[5])*r;e[1]=(t[2]-t[6])*r;e[2]=(t[3]-t[1])*r}else{var i=0;if(t[4]>t[0])i=1;if(t[8]>t[i*3+i])i=2;var s=(i+1)%3;var o=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[s*3+s]-t[o*3+o]+1);e[i]=.5*r;r=.5/r;e[3]=(t[o*3+s]-t[s*3+o])*r;e[s]=(t[s*3+i]+t[i*3+s])*r;e[o]=(t[o*3+i]+t[i*3+o])*r}return e};p.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};if(typeof e!=="undefined"){e.quat=p}})(t.exports)})(this);var webglUtil={createGLContext:function(e){var t=e.getContext("webgl");t.viewportWidth=e.width;t.viewportHeight=e.height;return t},createProgram:function(e,t,n){var r=n.createProgram();var i=this.loadShadersFromHTML(e,t,n);n.attachShader(r,i.vertexShader);n.attachShader(r,i.fragmentShader);n.linkProgram(r);return r},loadShadersFromHTML:function(e,t,n){var r=document.getElementById(e).innerHTML.trim();var i=document.getElementById(t).innerHTML.trim();var s=n.createShader(n.VERTEX_SHADER);n.shaderSource(s,r);n.compileShader(s);var o=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(o,i);n.compileShader(o);var u=n.getShaderParameter(s,n.COMPILE_STATUS);if(!u){console.log("Failed to compile vertex shader")}var u=n.getShaderParameter(o,n.COMPILE_STATUS);if(!u){console.log("Failed to compile fragment shader")}return{vertexShader:s,fragmentShader:o}},prepareElementBuffer:function(e,t){var n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n);t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null);n.numOfIndices=e.length;return n},prepareArrayBuffer:function(e,t){var n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,null);return n},prepareLabelTexture:function(e,t){var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,true);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindTexture(t.TEXTURE_2D,null);return n},prepareModelBuffers:function(e){var t=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]);var n=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]);var r=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]);var i=new Float32Array([1.001,1.001,1.001,-1.001,1.001,1.001,-1.001,-1.001,1.001,1.001,-1.001,1.001,1.001,-1.001,-1.001,1.001,1.001,-1.001,-1.001,1.001,-1.001,-1.001,-1.001,-1.001]);var s=new Uint8Array([0,1,1,6,6,5,5,0,1,2,6,7,5,4,0,3,3,2,2,7,7,4,4,3]);var o=new Float32Array([-1,0,1,1,0,1,1,0,-1,-1,0,-1]);var u=new Uint8Array([0,1,2,2,3,0]);var a=new Float32Array([0,0,1,.1,1,1,0,1]);var f=this.prepareArrayBuffer(t,e);var l=this.prepareArrayBuffer(n,e);var c=this.prepareElementBuffer(r,e);var h=this.prepareArrayBuffer(i,e);var p=this.prepareElementBuffer(s,e);var d=this.prepareArrayBuffer(o,e);var v=this.prepareElementBuffer(u,e);var m=this.prepareArrayBuffer(a,e);return{verticesBuffer:f,normalsBuffer:l,indicesBuffer:c,wireFrameVerticesBuffer:h,cubeWireFrameIndicesBuffer:p,planeVerticesBuffer:d,planeIndicesBuffer:v,planeTextureCoordinatesBuffer:m}},createFrameBufferObject:function(e){var t=e.createFramebuffer();var n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.viewportWidth,e.viewportHeight,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,e.viewportWidth,e.viewportHeight);e.bindFramebuffer(e.FRAMEBUFFER,t);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r);e.bindFramebuffer(e.FRAMEBUFFER,null);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null);return t}};var canvasLabelGenerator={ctx:null,width:1500,height:40,create:function(e){if(this.ctx===null){e.width=this.width;e.height=this.height;this.ctx=e.getContext("2d")}return this},generateLabelImageDataBasedOnText:function(e){this.ctx.clearRect(0,0,this.width,this.height);this.ctx.fillStyle="white";this.ctx.fillRect(0,0,this.width,this.height);this.ctx.fillStyle="black";this.ctx.font="30px Arial";this.ctx.textAlign="center";this.ctx.textBaseline="middle";var t=this.ctx.measureText(e).width+10;this.ctx.fillText(e,t/2,this.height/2);return{imageData:this.ctx.getImageData(0,0,t,this.height),textWidth:t,textHeight:this.height}}};var threeDgridWebgl={draw:function(e,t,n,r,i){function N(e){s=webglUtil.createGLContext(t);o=webglUtil.createProgram("shader-vertex","shader-fragment",s);u=webglUtil.createProgram("shader-simple-vertex","shader-simple-fragment",s);a=webglUtil.createProgram("shader-label-vertex","shader-label-fragment",s);f=webglUtil.createFrameBufferObject(s);console.log("program successfully created");s.enable(s.DEPTH_TEST);m=convertToCuboidModels(e,i,7,false,e.series.focus);g=createLabelPlanes(e,s,n);v=webglUtil.prepareModelBuffers(s);console.log("model data buffers successfully created.");C();k();L();console.log("webgl stuffs ready");V(r);_();X()}function C(){s.useProgram(o);var e=s.getAttribLocation(o,"MCVertex");o.aPositionIdx=e;var t=s.getAttribLocation(o,"MCNormal");o.aNormalIdx=t;o.uMVPMatrixIdx=s.getUniformLocation(o,"MVPMatrix");o.uNormalMatrixIdx=s.getUniformLocation(o,"NormalMatrix");o.uMVMatrixIdx=s.getUniformLocation(o,"MVMatrix");mat4.perspective(h,Math.PI*.2,s.viewportWidth/s.viewportHeight,1,2e3);mat4.lookAt(p,vec3.fromValues(5,40,40),vec3.fromValues(0,4,0),vec3.fromValues(0,1,0));mat4.multiply(d,h,p);var n=s.getUniformLocation(o,"ecDirectionalLightPositionOne");var r=vec3.fromValues(-100,100,100);var i=vec3.create();vec3.transformMat4(i,r,p);s.uniform3fv(n,i);var u=s.getUniformLocation(o,"ecDirectionalLightPositionTwo");var a=vec3.fromValues(100,-100,0);var f=vec3.create();vec3.transformMat4(f,a,p);s.uniform3fv(u,f);o.uMaterialColorIdx=s.getUniformLocation(o,"materialColor");o.uIsTranslucentIdx=s.getUniformLocation(o,"IsTranslucent");s.clearColor(1,1,1,1)}function k(){s.useProgram(u);u.aPositionIdx=s.getAttribLocation(u,"MCVertex");u.uMVPMatrixIdx=s.getUniformLocation(u,"MVPMatrix");u.uMaterialColorIdx=s.getUniformLocation(u,"materialColor")}function L(){s.useProgram(a);a.aPositionIdx=s.getAttribLocation(a,"MCVertex");a.aTexCoordIdx=s.getAttribLocation(a,"aTexCoord");a.uMVPMatrixIdx=s.getUniformLocation(a,"MVPMatrix");a.uSamplerIdx=s.getUniformLocation(a,"uSampler")}function A(){if(!y){c=l+(E-b)/600*x;D();requestAnimationFrame(A)}}function O(){y=false;l=c;A()}function M(){y=true}function _(){D()}function D(){s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);F();P();j()}function P(){s.useProgram(o);s.bindBuffer(s.ARRAY_BUFFER,v.verticesBuffer);s.vertexAttribPointer(o.aPositionIdx,3,s.FLOAT,false,0,0);s.enableVertexAttribArray(o.aPositionIdx);s.bindBuffer(s.ARRAY_BUFFER,null);s.bindBuffer(s.ARRAY_BUFFER,v.normalsBuffer);s.vertexAttribPointer(o.aNormalIdx,3,s.FLOAT,false,0,0);s.enableVertexAttribArray(o.aNormalIdx);s.bindBuffer(s.ARRAY_BUFFER,null);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,v.indicesBuffer);H();B()}function H(){s.uniform1i(o.uIsTranslucentIdx,0);if(threeModels.isAnythingFocused()){for(var e in m){if(m[e].isFocus){I(m[e],false)}}}else{for(var e in m){I(m[e],false)}}}function B(){if(threeModels.isAnythingFocused()){s.depthMask(false);s.enable(s.BLEND);s.blendEquation(s.FUNC_ADD);s.blendFunc(s.ZERO,s.SRC_COLOR);s.uniform1i(o.uIsTranslucentIdx,1);for(var e in m){I(m[e],true)}s.depthMask(true);s.disable(s.BLEND)}}function j(){s.useProgram(u);s.bindBuffer(s.ARRAY_BUFFER,v.wireFrameVerticesBuffer);s.vertexAttribPointer(u.aPositionIdx,3,s.FLOAT,false,0,0);s.enableVertexAttribArray(u.aPositionIdx);s.bindBuffer(s.ARRAY_BUFFER,null);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,v.cubeWireFrameIndicesBuffer);for(var e in m){q(m[e])}}function F(){s.useProgram(a);s.bindBuffer(s.ARRAY_BUFFER,v.planeVerticesBuffer);s.vertexAttribPointer(a.aPositionIdx,3,s.FLOAT,false,0,0);s.enableVertexAttribArray(a.aPositionIdx);s.bindBuffer(s.ARRAY_BUFFER,v.planeTextureCoordinatesBuffer);s.vertexAttribPointer(a.aTexCoordIdx,2,s.FLOAT,false,0,0);s.enableVertexAttribArray(a.aTexCoordIdx);s.activeTexture(s.TEXTURE0);s.uniform1i(a.uSamplerIdx,0);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,v.planeIndicesBuffer);for(var e in g){R(g[e])}}function I(e,t){e.calculateModelMatrix(c);mat4.multiply(e.MVPMatrix,d,e.modelMatrix);s.uniformMatrix4fv(o.uMVPMatrixIdx,false,e.MVPMatrix);mat4.multiply(e.MVMatrix,p,e.modelMatrix);mat3.normalFromMat4(e.normalMatrix,e.MVMatrix);s.uniformMatrix4fv(o.uMVMatrixIdx,false,e.MVMatrix);s.uniformMatrix3fv(o.uNormalMatrixIdx,false,e.normalMatrix);if(!t){var n=e.fillColorArray;var r=vec3.fromValues(n[0],n[1],n[2]);s.uniform3fv(o.uMaterialColorIdx,r)}else{var r=vec3.fromValues(1,1,1);s.uniform3fv(o.uMaterialColorIdx,r)}s.drawElements(s.TRIANGLES,v.indicesBuffer.numOfIndices,s.UNSIGNED_BYTE,0)}function q(e){var t;if(!e.isFocus&&threeModels.isAnythingFocused()){t=vec3.fromValues(.6,.6,.6)}else{t=vec3.fromValues(.8,.8,.8)}s.uniformMatrix4fv(u.uMVPMatrixIdx,false,e.MVPMatrix);s.uniform3fv(u.uMaterialColorIdx,t);s.drawElements(s.LINES,v.cubeWireFrameIndicesBuffer.numOfIndices,s.UNSIGNED_BYTE,0)}function R(e){e.calculateModelMatrix(c);mat4.multiply(e.MVPMatrix,d,e.modelMatrix);s.uniformMatrix4fv(a.uMVPMatrixIdx,false,e.MVPMatrix);s.bindTexture(s.TEXTURE_2D,e.texture);s.drawElements(s.TRIANGLES,v.planeIndicesBuffer.numOfIndices,s.UNSIGNED_BYTE,0)}function U(e,t){s.bindFramebuffer(s.FRAMEBUFFER,f);s.useProgram(u);s.bindBuffer(s.ARRAY_BUFFER,v.verticesBuffer);s.vertexAttribPointer(u.aPositionIdx,3,s.FLOAT,false,0,0);s.enableVertexAttribArray(u.aPositionIdx);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,v.indicesBuffer);var n=-1;for(var r in m){if(z(r,e,s.viewportHeight-t)){n=r;break}}s.bindFramebuffer(s.FRAMEBUFFER,null);return n}function z(e,t,n){s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var r=new Uint8Array(4);for(var i in m){var o=m[i];s.uniformMatrix4fv(u.uMVPMatrixIdx,false,o.MVPMatrix);if(i===e){var a=vec3.fromValues(1,0,0);s.uniform3fv(u.uMaterialColorIdx,a)}else{var a=vec3.fromValues(0,0,0);s.uniform3fv(u.uMaterialColorIdx,a)}s.drawElements(s.TRIANGLES,v.indicesBuffer.numOfIndices,s.UNSIGNED_BYTE,0)}s.readPixels(t,n,1,1,s.RGBA,s.UNSIGNED_BYTE,r);if(r[0]===255&&r[1]===0&&r[2]===0){return true}}function W(e,t,n,r,i,s,o){var u=vec4.fromValues(0,1,0,1);vec4.transformMat4(u,u,e);var a=[u[0]/u[3],u[1]/u[3]];var f=a[0]*(n/2)+n/2;var l=r/2-a[1]*(r/2);o.genericShowDoubleLineTipDataYOnly(f,l,i,t,s)}function X(){for(var e=0;e<m.length;e++){var t=m[e];if(t.isFocus){W(t.MVPMatrix,t.mcColor,s.viewportWidth,s.viewportHeight,t.label,t.dataY,t.staticTipControl)}}}function V(e){function r(){var e=t.getBoundingClientRect();var n=E-e.left;var r=S-e.top;return U(n,r)}function i(e){e.addEventListener("mousemove",function(e){E=e.clientX;S=e.clientY})}function o(e){var t=-1;var i=-1;e.addEventListener("mouseover",function(e){t=window.setInterval(function(){if(n){return}var e=r();if(e!==-1&&m[e].isFocus){e=-1}if(i!==-1&&e===-1){T.hideTip();i=e}else if(i!==e){var t=m[e];W(t.MVPMatrix,t.mcColor,s.viewportWidth,s.viewportHeight,t.label,t.dataY,T);i=e}},1e3)});e.addEventListener("mouseout",function(){T.hideTip();window.clearInterval(t)})}function u(e){e.addEventListener("mousedown",function(e){n=true;T.hideTipImmediately();b=e.clientX;w=e.clientY;O()});window.addEventListener("mouseup",function(){if(Math.abs(E-b)>3||Math.abs(S-w)>3){n=false;M();X()}else{n=false;M();var e=r();if(e!==-1){var t=m[e];if(t.toggleFocus()){W(t.MVPMatrix,t.mcColor,s.viewportWidth,s.viewportHeight,t.label,t.dataY,t.staticTipControl)}else{t.staticTipControl.hideTip()}_()}}})}var n=false;i(e);o(e);u(e)}var s;var o;var u;var a;var f;var l=0;var c=e.startAngle;var h=mat4.create();var p=mat4.create();var d=mat4.create();var v;var m=[];var g=[];var y=false;var b=0;var w=0;var E=0;var S=0;var x=Math.PI/2;var T=new TipControl(i,7,false);T.createTip();e.meta={};e.meta.rows=e.series.rows;e.meta.columns=e.series.columns;e.data=e.series.data;N(e)}};var weaver={createContainers:function(e,t){e.setAttribute("class","mc-container");var n=e.getBoundingClientRect();var r=n.width;var i=n.height;var s;var o;var u;var a;var f;var l;if(t.offScreenCanvas){l=document.createElement("canvas");l.style.display="none";e.appendChild(l)}if(t.svg){s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute";s.style.left="0px";s.style.top="0px";s.setAttributeNS(null,"width",r.toString());s.setAttributeNS(null,"height",i.toString());e.appendChild(s)}if(t.canvas){a=document.createElement("canvas");e.appendChild(a)}if(t.tipContainer){o=document.createElement("div");o.setAttribute("class","mc-div-draw-layer");e.appendChild(o)}if(t.svgTrigger){u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttributeNS(null,"width",r.toString());u.setAttributeNS(null,"height",i.toString());u.style.position="absolute";u.style.left="0";u.style.top="0";e.appendChild(u)}if(t.canvasTrigger){f=document.createElement("div");e.appendChild(f)}return{svg:s,div:o,svgTrigger:u,canvas:a,offScreenCanvas:l,canvasTrigger:f}},weave:function(e,t,n){switch(e){case"basicLineIrregular":this.weaveBasicLineIrregular(t,n);break;case"basicLineRegular":this.weaveBasicLineRegular(t,n);break;case"basicCategory":this.weaveBasicCategory(t,n);break;case"singleTime":this.weaveSingleTime(t,n);break;case"basicStackRegular":this.weaveBasicStackRegular(t,n);break;case"basicPieChart":this.weaveBasicPieChart(t,n);break;case"3dGrid":this.weave3dGrid(t,n);break}},weaveBasicLineIrregular:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true});var r=n.svg;var i=n.div;var s=n.svgTrigger;colors.initLinearGradients(r);var o=new Legend(r,e.series,e.legend);o.analyze();var u=new GeneralLayout(r,e.mainTitle,e.subTitle,e.yAxisTitle,e.xAxisTitle,o);var a=10;var f=10;var l=u.analyze();var c=l.xAxisLength-a-f;var h=(new BasicLineIrregularDataAnalyst(e,c)).analyze();var p=new X_LinearAxis(r,c,h.minX,h.maxX,l.originPosition,a,f);var d=new Y_LinearAxis(r,l.yAxisLength,h.minY,h.maxY,l.originPosition,p,false,false);var v=p.analyze();var m=d.analyze();var g=new BasicLineIrregularDataViewer(i,r,s,e,v,m,h.isContinual);u.draw();p.draw();d.draw();g.draw()},weaveBasicLineRegular:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true});var r=n.svg;var i=n.div;var s=n.svgTrigger;colors.initLinearGradients(r);var o=new Legend(r,e.series,e.legend);o.analyze();var u=new GeneralLayout(r,e.mainTitle,e.subTitle,e.yAxisTitle,e.xAxisTitle,o);var a=0;var f=0;var l=u.analyze();var c=l.xAxisLength-a-f;var h=(new BasicLineRegularDataAnalyst(e,c)).analyze();var p=new X_LinearAxis(r,c,e.start,h.maxX,l.originPosition,a,f);var d=new Y_LinearAxis(r,l.yAxisLength,h.minY,h.maxY,l.originPosition,p,false,false);var v=p.analyze();var m=d.analyze();var g=new BasicLineRegularDataViewer(i,r,s,e,v,m,h.isContinual);u.draw();p.draw();d.draw();g.draw()},weaveBasicCategory:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true});var r=n.svg;var i=n.div;var s=n.svgTrigger;colors.initLinearGradients(r);var o=new Legend(r,e.series,e.legend,"rectangular");o.analyze();var u=new GeneralLayout(r,e.mainTitle,e.subTitle,e.yAxisTitle,e.xAxisTitle,o);var a=u.analyze();var f=(new BasicCategoryDataAnalyst(e)).analyze();var l=0;var c=0;var h=new X_CategoryAxis(r,a.xAxisLength-l-c,a.originPosition,f.seriesNames,l,c);var p=new Y_LinearAxis(r,a.yAxisLength,f.minY,f.maxY,a.originPosition,h,false,false);var d=h.analyze();var v=p.analyze();var m=new BasicCategoryDataViewer(i,r,s,e,d,v);u.draw();h.draw();p.draw();m.draw()},weaveSingleTime:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true});var r=n.svg;var i=n.div;var s=n.svgTrigger;colors.initLinearGradients(r);var o=new Legend(r,e.series,e.legend,"rectangular");o.analyze();var u=new GeneralLayout(r,e.mainTitle,e.subTitle,e.yAxisTitle,e.xAxisTitle,o);var a=u.analyze();var f=(new BasicLineRegularDataAnalyst(e,a.xAxisLength)).analyze();var l=new TimeAxis(r,a.xAxisLength,f.maxX,a.originPosition,e.unit,e.interval);var c=new Y_LinearAxis(r,a.yAxisLength,f.minY,f.maxY,a.originPosition,l,false,false);var h=l.analyze();var p=c.analyze();var d=new BasicSingleTimeData(i,r,s,e,h,p,f.isContinual);u.draw();l.draw();c.draw();d.draw()},weaveBasicStackRegular:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true});var r=n.svg;var i=n.div;var s=n.svgTrigger;colors.initLinearGradients(r);var o=new Legend(r,e.series,e.legend);o.analyze();var u=new GeneralLayout(r,e.mainTitle,e.subTitle,e.yAxisTitle,e.xAxisTitle,o);var a=0;var f=0;var l=u.analyze();var c=l.xAxisLength-a-f;var h=(new BasicStackRegularDataAnalyst(e,c)).analyze();var p=new X_LinearAxis(r,c,e.start,h.maxX,l.originPosition,a,f);var d=new Y_LinearAxis(r,l.yAxisLength,h.minY,h.maxY,l.originPosition,p,true,false);var v=p.analyze();var m=d.analyze();var g=new BasicStackRegularDataViewer(i,r,s,e,v,m,h.isContinual);u.draw();p.draw();d.draw();g.draw()},weaveBasicPieChart:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true});var r=n.svg;var i=n.div;var s=n.svgTrigger;colors.initLinearGradients(r);var o=new Legend(r,e.series,e.legend);o.analyze();var u=new LayoutNoAxes(r,e.mainTitle,e.subTitle,o);var a=u.analyze();var f=new BasicPieDataAnalyst(e);var l=f.analyze();var c=new BasicPieDataViewer(i,r,s,e,a.center,a.dataDrawAreaX,a.dataDrawAreaY,a.radiusForLabel,a.radiusForPie,a.radiusForConnectionLine,l.total);c.draw();u.draw()},weave3dGrid:function(e,t){var n=this.createContainers(t,{svg:true,svgTrigger:true,tipContainer:true,canvas:true,offScreenCanvas:true,canvasTrigger:true});t.style.background="white";var r=n.svg;var i=n.div;var s=n.svgTrigger;var o=n.canvas;var u=n.offScreenCanvas;var a=n.canvasTrigger;colors.initLinearGradients(r);var f=[];var l=new Legend(r,e.series,e.rowLegend,"rectangular");l.analyze(e.series.rows,true);var c=new Legend(r,e.series,e.columnLegend);c.analyze(e.series.columns,false);f.push(l);f.push(c);var h=new MultipleLegendLayout(r,e.mainTitle,e.subTitle,f);var p=h.analyze();var d=[p.originPosition[0],p.originPosition[1]-p.dataDrawAreaY];var v=[p.dataDrawAreaX,p.dataDrawAreaY];o.style.position="absolute";o.style.left=d[0]+"px";o.style.top=d[1]+"px";o.width=v[0];o.height=v[1];a.style.position="absolute";a.style.left=d[0]+"px";a.style.top=d[1]+"px";a.style.width=v[0]+"px";a.style.height=v[1]+"px";i.style.left=d[0]+"px";i.style.top=d[1]+"px";i.style.width=v[0]+"px";i.style.height=v[1]+"px";s.style.display="none";h.draw();threeDgridWebgl.draw(e,o,u,a,i)}}